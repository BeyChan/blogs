<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title>02-Appå¯åŠ¨é€Ÿåº¦æ€ä¹ˆåšä¼˜åŒ–ä¸ç›‘æ§ï¼Ÿ</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
        <style>
        html {
            color: #333;
            -webkit-text-size-adjust: 100%;
            -ms-text-size-adjust: 100%;
            text-rendering: optimizelegibility;
            font-family: Helvetica Neue, PingFang SC, Verdana, Microsoft Yahei, Hiragino Sans GB, Microsoft Sans Serif, WenQuanYi Micro Hei, sans-serif
        }

        html.borderbox *,
        html.borderbox :after,
        html.borderbox :before {
            box-sizing: border-box
        }

        article,
        aside,
        blockquote,
        body,
        button,
        code,
        dd,
        details,
        dl,
        dt,
        fieldset,
        figcaption,
        figure,
        footer,
        form,
        h1,
        h2,
        h3,
        h4,
        h5,
        h6,
        header,
        hr,
        input,
        legend,
        li,
        menu,
        nav,
        ol,
        p,
        pre,
        section,
        td,
        textarea,
        th,
        ul {
            margin: 0;
            padding: 0
        }

        article,
        aside,
        details,
        figcaption,
        figure,
        footer,
        header,
        menu,
        nav,
        section {
            display: block
        }

        audio,
        canvas,
        video {
            display: inline-block
        }

        body,
        button,
        input,
        select,
        textarea {
            font: 300 1em/1.8 PingFang SC, Lantinghei SC, Microsoft Yahei, Hiragino Sans GB, Microsoft Sans Serif, WenQuanYi Micro Hei, Helvetica, sans-serif
        }

        button::-moz-focus-inner,
        input::-moz-focus-inner {
            padding: 0;
            border: 0
        }

        table {
            border-collapse: collapse;
            border-spacing: 0
        }

        fieldset,
        img {
            border: 0
        }

        blockquote {
            position: relative;
            color: #999;
            font-weight: 400;
            border-left: 1px solid #1abc9c;
            padding-left: 1em;
            margin: 1em 3em 1em 2em
        }

        @media only screen and (max-width: 640px) {
            blockquote {
                margin: 1em 0
            }
        }

        abbr,
        acronym {
            border-bottom: 1px dotted;
            font-variant: normal
        }

        abbr {
            cursor: help
        }

        del {
            text-decoration: line-through
        }

        address,
        caption,
        cite,
        code,
        dfn,
        em,
        th,
        var {
            font-style: normal;
            font-weight: 400
        }

        ol,
        ul {
            list-style: none
        }

        caption,
        th {
            text-align: left
        }

        q:after,
        q:before {
            content: ""
        }

        sub,
        sup {
            font-size: 75%;
            line-height: 0;
            position: relative
        }

        :root sub,
        :root sup {
            vertical-align: baseline
        }

        sup {
            top: -.5em
        }

        sub {
            bottom: -.25em
        }

        a {
            color: #1abc9c
        }

        a:hover {
            text-decoration: underline
        }

        .typo a {
            border-bottom: 1px solid #1abc9c
        }

        .typo a:hover {
            border-bottom-color: #555;
            color: #555
        }

        .typo a:hover,
        a,
        ins {
            text-decoration: none
        }

        .typo-u,
        u {
            text-decoration: underline
        }

        mark {
            background: #fffdd1;
            border-bottom: 1px solid #ffedce;
            padding: 2px;
            margin: 0 5px
        }

        code,
        pre,
        pre tt {
            font-family: Courier, Courier New, monospace
        }

        pre {
            background: hsla(0, 0%, 97%, .7);
            border: 1px solid #ddd;
            padding: 1em 1.5em;
            display: block;
            -webkit-overflow-scrolling: touch
        }

        hr {
            border: none;
            border-bottom: 1px solid #cfcfcf;
            margin-bottom: .8em;
            height: 10px
        }

        .typo-small,
        figcaption,
        small {
            font-size: .9em;
            color: #888
        }

        b,
        strong {
            font-weight: 700;
            color: #000
        }

        [draggable] {
            cursor: move
        }

        .clearfix:after,
        .clearfix:before {
            content: "";
            display: table
        }

        .clearfix:after {
            clear: both
        }

        .clearfix {
            zoom: 1
        }

        .textwrap,
        .textwrap td,
        .textwrap th {
            word-wrap: break-word;
            word-break: break-all
        }

        .textwrap-table {
            table-layout: fixed
        }

        .serif {
            font-family: Palatino, Optima, Georgia, serif
        }

        .typo-dl,
        .typo-form,
        .typo-hr,
        .typo-ol,
        .typo-p,
        .typo-pre,
        .typo-table,
        .typo-ul,
        .typo dl,
        .typo form,
        .typo hr,
        .typo ol,
        .typo p,
        .typo pre,
        .typo table,
        .typo ul,
        blockquote {
            margin-bottom: 1rem
        }

        h1,
        h2,
        h3,
        h4,
        h5,
        h6 {
            font-family: PingFang SC, Helvetica Neue, Verdana, Microsoft Yahei, Hiragino Sans GB, Microsoft Sans Serif, WenQuanYi Micro Hei, sans-serif;
            color: #000;
            line-height: 1.35
        }

        .typo-h1,
        .typo-h2,
        .typo-h3,
        .typo-h4,
        .typo-h5,
        .typo-h6,
        .typo h1,
        .typo h2,
        .typo h3,
        .typo h4,
        .typo h5,
        .typo h6 {
            margin-top: 1.2em;
            margin-bottom: .6em;
            line-height: 1.35
        }

        .typo-h1,
        .typo h1 {
            font-size: 2em
        }

        .typo-h2,
        .typo h2 {
            font-size: 1.8em
        }

        .typo-h3,
        .typo h3 {
            font-size: 1.6em
        }

        .typo-h4,
        .typo h4 {
            font-size: 1.4em
        }

        .typo-h5,
        .typo-h6,
        .typo h5,
        .typo h6 {
            font-size: 1.2em
        }

        .typo-ul,
        .typo ul {
            margin-left: 1.3em;
            list-style: disc
        }

        .typo-ol,
        .typo ol {
            list-style: decimal;
            margin-left: 1.9em
        }

        .typo-ol ol,
        .typo-ol ul,
        .typo-ul ol,
        .typo-ul ul,
        .typo li ol,
        .typo li ul {
            margin-bottom: .8em;
            margin-left: 2em
        }

        .typo-ol ul,
        .typo-ul ul,
        .typo li ul {
            list-style: circle
        }

        .typo-table td,
        .typo-table th,
        .typo table caption,
        .typo table td,
        .typo table th {
            border: 1px solid #ddd;
            padding: .5em 1em;
            color: #666
        }

        .typo-table th,
        .typo table th {
            background: #fbfbfb
        }

        .typo-table thead th,
        .typo table thead th {
            background: hsla(0, 0%, 95%, .7)
        }

        .typo table caption {
            border-bottom: none
        }

        .typo-input,
        .typo-textarea {
            -webkit-appearance: none;
            border-radius: 0
        }

        .typo-em,
        .typo em,
        caption,
        legend {
            color: #000;
            font-weight: inherit
        }

        .typo-em {
            position: relative
        }

        .typo-em:after {
            position: absolute;
            top: .65em;
            left: 0;
            width: 100%;
            overflow: hidden;
            white-space: nowrap;
            content: "\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB"
        }

        .typo img {
            max-width: 100%
        }

        .common-content {
            font-weight: 400;
            color: #353535;
            line-height: 1.75rem;
            white-space: normal;
            word-break: normal;
            font-size: 1rem
        }

        .common-content img {
            display: block;
            max-width: 100%;
            background-color: #eee
        }

        .common-content audio,
        .common-content video {
            width: 100%;
            background-color: #eee
        }

        .common-content center,
        .common-content font {
            margin-top: 1rem;
            display: inline-block
        }

        .common-content center {
            width: 100%
        }

        .common-content pre {
            margin-top: 1rem;
            padding-left: 0;
            padding-right: 0;
            position: relative;
            overflow: hidden
        }

        .common-content pre code {
            font-size: .8rem;
            font-family: Consolas, Liberation Mono, Menlo, monospace, Courier;
            display: block;
            width: 100%;
            box-sizing: border-box;
            padding-left: 1rem;
            padding-right: 1rem;
            overflow-x: auto
        }

        .common-content hr {
            border: none;
            margin-top: 1.5rem;
            margin-bottom: 1.5rem;
            border-top: 1px solid #f5f5f5;
            height: 1px;
            background: none
        }

        .common-content b,
        .common-content h1,
        .common-content h2,
        .common-content h3,
        .common-content h4,
        .common-content h5,
        .common-content strong {
            font-weight: 700
        }

        .common-content h1,
        .common-content h2 {
            font-size: 1.125rem;
            margin-bottom: .45rem
        }

        .common-content h3,
        .common-content h4,
        .common-content h5 {
            font-size: 1rem;
            margin-bottom: .45rem
        }

        .common-content p {
            font-weight: 400;
            color: #353535;
            margin-top: .15rem
        }

        .common-content .orange {
            color: #ff5a05
        }

        .common-content .reference {
            font-size: 1rem;
            color: #888
        }

        .custom-rich-content h1 {
            margin-top: 0;
            font-weight: 400;
            font-size: 15.25px;
            border-bottom: 1px solid #eee;
            line-height: 2.8
        }

        .custom-rich-content li,
        .custom-rich-content p {
            font-size: 14px;
            color: #888;
            line-height: 1.6
        }

        table.hljs-ln {
            margin-bottom: 0;
            border-spacing: 0;
            border-collapse: collapse
        }

        table.hljs-ln,
        table.hljs-ln tbody,
        table.hljs-ln td,
        table.hljs-ln tr {
            box-sizing: border-box
        }

        table.hljs-ln td {
            padding: 0;
            border: 0
        }

        table.hljs-ln td.hljs-ln-numbers {
            min-width: 15px;
            color: rgba(27, 31, 35, .3);
            text-align: right;
            white-space: nowrap;
            cursor: pointer;
            user-select: none
        }

        table.hljs-ln td.hljs-ln-code,
        table.hljs-ln td.hljs-ln-numbers {
            font-family: SFMono-Regular, Consolas, Liberation Mono, Menlo, Courier, monospace;
            font-size: 12px;
            line-height: 20px;
            vertical-align: top
        }

        table.hljs-ln td.hljs-ln-code {
            position: relative;
            padding-right: 10px;
            padding-left: 10px;
            overflow: visible;
            color: #24292e;
            word-wrap: normal;
            white-space: pre
        }

        video::-webkit-media-controls {
            overflow: hidden !important
        }

        video::-webkit-media-controls-enclosure {
            width: calc(100% + 32px);
            margin-left: auto
        }

        ._29HP61GA_0 {
            max-width:800px;
            margin:0 auto;
            margin-bottom: 20px;
            font-weight: 400;
            color: #353535;
            line-height: 1.76;
            white-space: normal;
            word-break: normal;
            font-size: 17px;
            -webkit-transition: background-color .3s ease;
            transition: background-color .3s ease
        }

        ._29HP61GA_0 .MathJax_Display {
            overflow: auto
        }

        ._29HP61GA_0 .poster {
            position: fixed;
            left: -10000px;
            top: -10000px;
            overflow: hidden;
            padding: 1rem;
            background: #ececec
        }

        ._29HP61GA_0 .richcontent-pre-copy {
            font-size: 13px;
            color: #888;
            position: absolute;
            right: 1em;
            top: .5em;
            cursor: pointer;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none
        }

        ._29HP61GA_0 .richcontent-pre-copy .iconfont {
            font-size: 12px;
            margin-right: .2em
        }

        ._29HP61GA_0 a {
            color: #fa8919;
            border-bottom: 1px solid #fa8919
        }

        ._29HP61GA_0 img {
            display: block;
            max-width: 100%;
            position: relative;
            left: 50%;
            -webkit-transform: translateX(-50%);
            transform: translateX(-50%);
            background-color: #eee;
            vertical-align: top;
            border-radius: 0
        }

        ._29HP61GA_0 audio,
        ._29HP61GA_0 video {
            width: 100%;
            background-color: #eee
        }

        ._29HP61GA_0 pre {
            margin-top: 16px;
            padding: 34px 0 0;
            margin-bottom: 30px;
            position: relative;
            border-radius: 6px;
            background: rgba(246, 247, 251, .749);
            border: 0
        }

        ._29HP61GA_0 pre code {
            font-size: 12px;
            font-family: Consolas, Liberation Mono, Menlo, monospace, Courier;
            display: block;
            -webkit-box-sizing: border-box;
            box-sizing: border-box;
            margin-left: 16px;
            margin-right: 16px;
            overflow-x: scroll
        }

        ._29HP61GA_0 pre code:after {
            content: "";
            height: 30px;
            width: 100%;
            display: block
        }

        ._29HP61GA_0 hr {
            border: none;
            margin-top: 1.5rem;
            margin-bottom: 1.5rem;
            border-top: 1px solid #f5f5f5;
            height: 1px;
            background: none
        }

        ._29HP61GA_0 h1,
        ._29HP61GA_0 h2,
        ._29HP61GA_0 h3,
        ._29HP61GA_0 h4,
        ._29HP61GA_0 h5 {
            margin-bottom: 20px;
            margin-top: 0;
            font-weight: 700
        }

        ._29HP61GA_0 b,
        ._29HP61GA_0 strong {
            font-weight: 700
        }

        ._29HP61GA_0 h1 {
            font-size: 21px
        }

        ._29HP61GA_0 h2 {
            font-size: 20px
        }

        ._29HP61GA_0 h3 {
            font-size: 19px
        }

        ._29HP61GA_0 h4 {
            font-size: 18px
        }

        ._29HP61GA_0 h5 {
            font-size: 17px
        }

        ._29HP61GA_0 center,
        ._29HP61GA_0 p {
            font-weight: 400;
            color: #353535;
            margin-top: 0;
            margin-bottom: 30px;
            word-break: break-word
        }

        ._29HP61GA_0 center {
            text-align: center
        }

        ._29HP61GA_0 blockquote {
            margin-top: 0;
            margin-bottom: 34px;
            border-left: 3px solid #e8e8e8;
            padding-left: 17px;
            color: #353535
        }

        ._29HP61GA_0 blockquote p {
            margin-top: 0;
            margin-bottom: 0
        }

        ._29HP61GA_0 ol,
        ._29HP61GA_0 ul {
            margin-bottom: 30px
        }

        ._29HP61GA_0 ol p,
        ._29HP61GA_0 ul p {
            margin-top: 0;
            margin-bottom: 0
        }

        ._29HP61GA_0 ol {
            list-style: decimal;
            margin-left: 20px
        }

        ._29HP61GA_0 ul li {
            padding-left: 17px;
            position: relative;
            margin-bottom: 10px
        }

        ._29HP61GA_0 ul li:after {
            content: "";
            height: 6px;
            width: 6px;
            border-radius: 50%;
            background: #353535;
            position: absolute;
            top: 10px;
            left: 0
        }

        ._29HP61GA_0 .orange {
            color: #fa8919
        }

        ._29HP61GA_0 .reference {
            color: #888
        }

        ._29HP61GA_0 .m-right {
            text-align: right
        }

        ._29HP61GA_0 .m-center {
            text-align: center;
            display: block
        }

        ._29HP61GA_0 .m-gray {
            color: #888
        }

        ._29HP61GA_0 .m-small {
            font-size: 15px
        }

        ._29HP61GA_0 table.hljs-ln {
            margin-bottom: 0;
            border-spacing: 0;
            border-collapse: collapse
        }

        ._29HP61GA_0 table.hljs-ln,
        ._29HP61GA_0 table.hljs-ln tbody,
        ._29HP61GA_0 table.hljs-ln td,
        ._29HP61GA_0 table.hljs-ln tr {
            -webkit-box-sizing: border-box;
            box-sizing: border-box
        }

        ._29HP61GA_0 table.hljs-ln td {
            padding: 0;
            border: 0
        }

        ._29HP61GA_0 table.hljs-ln td.hljs-ln-numbers {
            min-width: 15px;
            font-size: 12px;
            color: rgba(27, 31, 35, .3);
            text-align: right;
            white-space: nowrap;
            cursor: pointer;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none
        }

        ._29HP61GA_0 table.hljs-ln td.hljs-ln-code,
        ._29HP61GA_0 table.hljs-ln td.hljs-ln-numbers {
            font-family: SFMono-Regular, Consolas, Liberation Mono, Menlo, Courier, monospace;
            line-height: 20px;
            vertical-align: top
        }

        ._29HP61GA_0 table.hljs-ln td.hljs-ln-code {
            position: relative;
            padding-right: 10px;
            padding-left: 10px;
            overflow: visible;
            font-size: 13px;
            color: #666;
            word-wrap: normal;
            white-space: pre
        }

    </style>
</head>
<body>
<div class="_29HP61GA_0">
<h1>02-Appå¯åŠ¨é€Ÿåº¦æ€ä¹ˆåšä¼˜åŒ–ä¸ç›‘æ§ï¼Ÿ</h1>
<p>ä½ å¥½ï¼Œæˆ‘æ˜¯æˆ´é“­ã€‚</p><p>æˆ‘å·²ç»åœ¨ä¸“æ çš„ç¬¬ä¸€ç¯‡æ–‡ç« ä¸­ï¼Œå’Œä½ æ¢³ç†äº†ä¸€ä»½iOSå¼€å‘çš„çŸ¥è¯†ä½“ç³»æ¡†æ¶å›¾ã€‚ä»Šå¤©ï¼Œæˆ‘ä»¬å°±æ­£å¼ä»åŸºç¡€å‡ºå‘ï¼Œå¼€å§‹è‡ªå·±çš„iOSå¼€å‘çŸ¥è¯†ä½“ç³»æ„å»ºä¹‹è·¯å§ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘å°±å…ˆå’Œä½ èŠèŠä¸Appå¯åŠ¨é€Ÿåº¦å¯†åˆ‡ç›¸å…³çš„é‚£äº›äº‹å„¿ã€‚å¸Œæœ›ä½ å¬æˆ‘è¯´å®Œå¯åŠ¨é€Ÿåº¦çš„äº‹å„¿ä¹‹åï¼Œåœ¨ä¸“æ é‡Œçš„å­¦ä¹ çŠ¶æ€ä¹Ÿèƒ½å¤Ÿå¿«é€Ÿåœ°å¯åŠ¨èµ·æ¥ã€‚</p><p>åœ¨æ–‡ç« å¼€å§‹å‰ï¼Œæˆ‘ä»¬å…ˆè®¾æƒ³è¿™ä¹ˆä¸€ä¸ªåœºæ™¯ï¼šå‡è®¾ä½ åœ¨æ’é˜Ÿç»“è´¦æ—¶ï¼Œæå‡ºæ‰‹æœºæ‰“å¼€Appç”²å‡†å¤‡æ‰«ç æ”¯ä»˜ï¼Œç»“æœåŠå¤©è¿›ä¸å»ï¼Œåé¢æ’é˜Ÿçš„äººç»™ä½ å‹åŠ›å¤Ÿå¤§å§ã€‚ç„¶åï¼Œä½ åˆæ‰“å¼€Appä¹™ï¼Œç§’è¿›ï¼Œæ”¯ä»˜å®Œæˆã€‚è¯•æƒ³ä¸€ä¸‹ï¼Œä»¥åå†æ”¯ä»˜æ—¶ä½ ä¼šé€‰æ‹©å“ªä¸ªAppå‘¢ã€‚</p><p>ä¸éš¾æƒ³è±¡ï¼Œåœ¨æä¾›çš„åŠŸèƒ½å’ŒæœåŠ¡ç›¸ä¼¼çš„æƒ…å†µä¸‹ï¼Œä¸€æ¬¾Appçš„å¯åŠ¨é€Ÿåº¦ï¼Œä¸å•å•æ˜¯ç”¨æˆ·ä½“éªŒçš„äº‹æƒ…ï¼Œå¾€å¾€è¿˜å†³å®šäº†å®ƒèƒ½å¦è·å–æ›´å¤šçš„ç”¨æˆ·ã€‚è¿™å°±å¥½åƒé™Œç”Ÿäººç¬¬ä¸€æ¬¡ç¢°é¢ï¼Œç¬¬ä¸€æ„Ÿè§‰å¾€å¾€å†³å®šäº†ä»–ä»¬æ¥ä¸‹æ¥æ˜¯å¦ä¼šç»§ç»­äº¤å¾€ã€‚</p><p>ç”±æ­¤å¯è§ï¼Œå¯åŠ¨é€Ÿåº¦çš„ä¼˜åŒ–å¿…ç„¶å°±æ˜¯Appå¼€å‘è¿‡ç¨‹ä¸­ï¼Œä¸å¯æˆ–ç¼ºçš„ä¸€ä¸ªç¯èŠ‚ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘å°±å…ˆå’Œä½ ä¸€èµ·åˆ†æä¸‹Appåœ¨å¯åŠ¨æ—¶éƒ½åšäº†å“ªäº›äº‹å„¿ã€‚</p><h2>App å¯åŠ¨æ—¶éƒ½å¹²äº†äº›ä»€ä¹ˆäº‹å„¿ï¼Ÿ</h2><p>ä¸€èˆ¬æƒ…å†µä¸‹ï¼ŒAppçš„å¯åŠ¨åˆ†ä¸ºå†·å¯åŠ¨å’Œçƒ­å¯åŠ¨ã€‚</p><ul>
<li>å†·å¯åŠ¨æ˜¯æŒ‡ï¼Œ App ç‚¹å‡»å¯åŠ¨å‰ï¼Œå®ƒçš„è¿›ç¨‹ä¸åœ¨ç³»ç»Ÿé‡Œï¼Œéœ€è¦ç³»ç»Ÿæ–°åˆ›å»ºä¸€ä¸ªè¿›ç¨‹åˆ†é…ç»™å®ƒå¯åŠ¨çš„æƒ…å†µã€‚è¿™æ˜¯ä¸€æ¬¡å®Œæ•´çš„å¯åŠ¨è¿‡ç¨‹ã€‚</li>
<li>çƒ­å¯åŠ¨æ˜¯æŒ‡ ï¼ŒApp åœ¨å†·å¯åŠ¨åç”¨æˆ·å°† App é€€åå°ï¼Œåœ¨ App çš„è¿›ç¨‹è¿˜åœ¨ç³»ç»Ÿé‡Œçš„æƒ…å†µä¸‹ï¼Œç”¨æˆ·é‡æ–°å¯åŠ¨è¿›å…¥ App çš„è¿‡ç¨‹ï¼Œè¿™ä¸ªè¿‡ç¨‹åšçš„äº‹æƒ…éå¸¸å°‘ã€‚</li>
</ul><!-- [[[read_end]]] --><p>æ‰€ä»¥ï¼Œä»Šå¤©è¿™ç¯‡æ–‡ç« ï¼Œæˆ‘ä»¬å°±åªå±•å¼€è®²Appå†·å¯åŠ¨çš„ä¼˜åŒ–ã€‚</p><p>ç”¨æˆ·èƒ½æ„ŸçŸ¥åˆ°çš„å¯åŠ¨æ…¢ï¼Œå…¶å®éƒ½å‘ç”Ÿåœ¨ä¸»çº¿ç¨‹ä¸Šã€‚è€Œä¸»çº¿ç¨‹æ…¢çš„åŸå› æœ‰å¾ˆå¤šï¼Œæ¯”å¦‚åœ¨ä¸»çº¿ç¨‹ä¸Šæ‰§è¡Œäº†å¤§æ–‡ä»¶è¯»å†™æ“ä½œã€åœ¨æ¸²æŸ“å‘¨æœŸä¸­æ‰§è¡Œäº†å¤§é‡è®¡ç®—ç­‰ã€‚ä½†æ˜¯ï¼Œæœ‰æ—¶ä½ ä¼šå‘ç°å³ä½¿ä½ æŠŠé¦–å±æ˜¾ç¤ºä¹‹å‰çš„è¿™äº›ä¸»çº¿ç¨‹çš„è€—æ—¶é—®é¢˜éƒ½è§£å†³äº†ï¼Œè¿˜æ˜¯æ¯”ç«å“å¯åŠ¨å¾—æ…¢ã€‚</p><p>é‚£ä¹ˆï¼Œ<strong>ç©¶ç«Ÿå¦‚ä½•æ‰èƒ½æŠŠå¯åŠ¨æ—¶çš„æ‰€æœ‰è€—æ—¶éƒ½æ‰¾å‡ºæ¥å‘¢ï¼Ÿè§£å†³è¿™ä¸ªé—®é¢˜ï¼Œä½ é¦–å…ˆéœ€è¦å¼„æ¸…æ¥š Appåœ¨å¯åŠ¨æ—¶éƒ½å¹²äº†å“ªäº›äº‹å„¿ã€‚</strong></p><p>ä¸€èˆ¬è€Œè¨€ï¼ŒAppçš„å¯åŠ¨æ—¶é—´ï¼ŒæŒ‡çš„æ˜¯ä»ç”¨æˆ·ç‚¹å‡»Appå¼€å§‹ï¼Œåˆ°ç”¨æˆ·çœ‹åˆ°ç¬¬ä¸€ä¸ªç•Œé¢ä¹‹é—´çš„æ—¶é—´ã€‚æ€»ç»“æ¥è¯´ï¼ŒAppçš„å¯åŠ¨ä¸»è¦åŒ…æ‹¬ä¸‰ä¸ªé˜¶æ®µï¼š</p><ol>
<li>
<p>main() å‡½æ•°æ‰§è¡Œå‰ï¼›</p>
</li>
<li>
<p>main() å‡½æ•°æ‰§è¡Œåï¼›</p>
</li>
<li>
<p>é¦–å±æ¸²æŸ“å®Œæˆåã€‚</p>
</li>
</ol><p>æ•´ä¸ªå¯åŠ¨è¿‡ç¨‹çš„ç¤ºæ„å›¾ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><p><img src="https://static001.geekbang.org/resource/image/8a/81/8af7e23cd98c8add88e2f8ed3405ed81.png" alt=""></p><center><span class="reference">å›¾1 Appçš„æ•´ä¸ªå¯åŠ¨è¿‡ç¨‹</span></center><h3>main() å‡½æ•°æ‰§è¡Œå‰</h3><p>åœ¨ main() å‡½æ•°æ‰§è¡Œå‰ï¼Œç³»ç»Ÿä¸»è¦ä¼šåšä¸‹é¢å‡ ä»¶äº‹æƒ…ï¼š</p><ul>
<li>åŠ è½½å¯æ‰§è¡Œæ–‡ä»¶ï¼ˆAppçš„.oæ–‡ä»¶çš„é›†åˆï¼‰ï¼›</li>
<li>åŠ è½½åŠ¨æ€é“¾æ¥åº“ï¼Œè¿›è¡Œ rebase æŒ‡é’ˆè°ƒæ•´å’Œ bind ç¬¦å·ç»‘å®šï¼›</li>
<li>Objc è¿è¡Œæ—¶çš„åˆå§‹å¤„ç†ï¼ŒåŒ…æ‹¬ Objc ç›¸å…³ç±»çš„æ³¨å†Œã€category æ³¨å†Œã€selector å”¯ä¸€æ€§æ£€æŸ¥ç­‰ï¼›</li>
<li>åˆå§‹åŒ–ï¼ŒåŒ…æ‹¬äº†æ‰§è¡Œ +load() æ–¹æ³•ã€attribute((constructor)) ä¿®é¥°çš„å‡½æ•°çš„è°ƒç”¨ã€åˆ›å»º C++ é™æ€å…¨å±€å˜é‡ã€‚</li>
</ul><p>ç›¸åº”åœ°ï¼Œè¿™ä¸ªé˜¶æ®µå¯¹äºå¯åŠ¨é€Ÿåº¦ä¼˜åŒ–æ¥è¯´ï¼Œå¯ä»¥åšçš„äº‹æƒ…åŒ…æ‹¬ï¼š</p><ul>
<li>å‡å°‘åŠ¨æ€åº“åŠ è½½ã€‚æ¯ä¸ªåº“æœ¬èº«éƒ½æœ‰ä¾èµ–å…³ç³»ï¼Œè‹¹æœå…¬å¸å»ºè®®ä½¿ç”¨æ›´å°‘çš„åŠ¨æ€åº“ï¼Œå¹¶ä¸”å»ºè®®åœ¨ä½¿ç”¨åŠ¨æ€åº“çš„æ•°é‡è¾ƒå¤šæ—¶ï¼Œå°½é‡å°†å¤šä¸ªåŠ¨æ€åº“è¿›è¡Œåˆå¹¶ã€‚æ•°é‡ä¸Šï¼Œè‹¹æœå…¬å¸æœ€å¤šå¯ä»¥æ”¯æŒ6ä¸ªéç³»ç»ŸåŠ¨æ€åº“åˆå¹¶ä¸ºä¸€ä¸ªã€‚</li>
<li>å‡å°‘åŠ è½½å¯åŠ¨åä¸ä¼šå»ä½¿ç”¨çš„ç±»æˆ–è€…æ–¹æ³•ã€‚</li>
<li>+load() æ–¹æ³•é‡Œçš„å†…å®¹å¯ä»¥æ”¾åˆ°é¦–å±æ¸²æŸ“å®Œæˆåå†æ‰§è¡Œï¼Œæˆ–ä½¿ç”¨ +initialize() æ–¹æ³•æ›¿æ¢æ‰ã€‚å› ä¸ºï¼Œåœ¨ä¸€ä¸ª +load() æ–¹æ³•é‡Œï¼Œè¿›è¡Œè¿è¡Œæ—¶æ–¹æ³•æ›¿æ¢æ“ä½œä¼šå¸¦æ¥ 4 æ¯«ç§’çš„æ¶ˆè€—ã€‚ä¸è¦å°çœ‹è¿™4æ¯«ç§’ï¼Œç§¯å°‘æˆå¤šï¼Œæ‰§è¡Œ+load() æ–¹æ³•å¯¹å¯åŠ¨é€Ÿåº¦çš„å½±å“ä¼šè¶Šæ¥è¶Šå¤§ã€‚</li>
<li>æ§åˆ¶C++ å…¨å±€å˜é‡çš„æ•°é‡ã€‚</li>
</ul><h3>main() å‡½æ•°æ‰§è¡Œå</h3><p>main() å‡½æ•°æ‰§è¡Œåçš„é˜¶æ®µï¼ŒæŒ‡çš„æ˜¯ä»main()å‡½æ•°æ‰§è¡Œå¼€å§‹ï¼Œåˆ°appDelegate çš„ didFinishLaunchingWithOptions æ–¹æ³•é‡Œé¦–å±æ¸²æŸ“ç›¸å…³æ–¹æ³•æ‰§è¡Œå®Œæˆã€‚</p><p>é¦–é¡µçš„ä¸šåŠ¡ä»£ç éƒ½æ˜¯è¦åœ¨è¿™ä¸ªé˜¶æ®µï¼Œä¹Ÿå°±æ˜¯é¦–å±æ¸²æŸ“å‰æ‰§è¡Œçš„ï¼Œä¸»è¦åŒ…æ‹¬äº†ï¼š</p><ul>
<li>é¦–å±åˆå§‹åŒ–æ‰€éœ€é…ç½®æ–‡ä»¶çš„è¯»å†™æ“ä½œï¼›</li>
<li>é¦–å±åˆ—è¡¨å¤§æ•°æ®çš„è¯»å–ï¼›</li>
<li>é¦–å±æ¸²æŸ“çš„å¤§é‡è®¡ç®—ç­‰ã€‚</li>
</ul><p>å¾ˆå¤šæ—¶å€™ï¼Œå¼€å‘è€…ä¼šæŠŠå„ç§åˆå§‹åŒ–å·¥ä½œéƒ½æ”¾åˆ°è¿™ä¸ªé˜¶æ®µæ‰§è¡Œï¼Œå¯¼è‡´æ¸²æŸ“å®Œæˆæ»åã€‚<strong>æ›´åŠ ä¼˜åŒ–çš„å¼€å‘æ–¹å¼ï¼Œåº”è¯¥æ˜¯</strong>ä»åŠŸèƒ½ä¸Šæ¢³ç†å‡ºå“ªäº›æ˜¯é¦–å±æ¸²æŸ“å¿…è¦çš„åˆå§‹åŒ–åŠŸèƒ½ï¼Œå“ªäº›æ˜¯ App å¯åŠ¨å¿…è¦çš„åˆå§‹åŒ–åŠŸèƒ½ï¼Œè€Œå“ªäº›æ˜¯åªéœ€è¦åœ¨å¯¹åº”åŠŸèƒ½å¼€å§‹ä½¿ç”¨æ—¶æ‰éœ€è¦åˆå§‹åŒ–çš„ã€‚æ¢³ç†å®Œä¹‹åï¼Œå°†è¿™äº›åˆå§‹åŒ–åŠŸèƒ½åˆ†åˆ«æ”¾åˆ°åˆé€‚çš„é˜¶æ®µè¿›è¡Œã€‚</p><h3>é¦–å±æ¸²æŸ“å®Œæˆå</h3><p>é¦–å±æ¸²æŸ“åçš„è¿™ä¸ªé˜¶æ®µï¼Œä¸»è¦å®Œæˆçš„æ˜¯ï¼Œéé¦–å±å…¶ä»–ä¸šåŠ¡æœåŠ¡æ¨¡å—çš„åˆå§‹åŒ–ã€ç›‘å¬çš„æ³¨å†Œã€é…ç½®æ–‡ä»¶çš„è¯»å–ç­‰ã€‚ä»å‡½æ•°ä¸Šæ¥çœ‹ï¼Œè¿™ä¸ªé˜¶æ®µæŒ‡çš„å°±æ˜¯æˆªæ­¢åˆ° didFinishLaunchingWithOptions æ–¹æ³•ä½œç”¨åŸŸå†…æ‰§è¡Œé¦–å±æ¸²æŸ“ä¹‹åçš„æ‰€æœ‰æ–¹æ³•æ‰§è¡Œå®Œæˆã€‚ç®€å•è¯´çš„è¯ï¼Œè¿™ä¸ªé˜¶æ®µå°±æ˜¯ä»æ¸²æŸ“å®Œæˆæ—¶å¼€å§‹ï¼Œåˆ° didFinishLaunchingWithOptions æ–¹æ³•ä½œç”¨åŸŸç»“æŸæ—¶ç»“æŸã€‚</p><p>è¿™ä¸ªé˜¶æ®µç”¨æˆ·å·²ç»èƒ½å¤Ÿçœ‹åˆ° App çš„é¦–é¡µä¿¡æ¯äº†ï¼Œæ‰€ä»¥ä¼˜åŒ–çš„ä¼˜å…ˆçº§æ’åœ¨æœ€åã€‚ä½†æ˜¯ï¼Œé‚£äº›ä¼šå¡ä½ä¸»çº¿ç¨‹çš„æ–¹æ³•è¿˜æ˜¯éœ€è¦æœ€ä¼˜å…ˆå¤„ç†çš„ï¼Œä¸ç„¶è¿˜æ˜¯ä¼šå½±å“åˆ°ç”¨æˆ·åé¢çš„äº¤äº’æ“ä½œã€‚</p><p>æ˜ç™½äº†Appå¯åŠ¨é˜¶æ®µéœ€è¦å®Œæˆçš„å·¥ä½œåï¼Œæˆ‘ä»¬å°±å¯ä»¥æœ‰çš„æ”¾çŸ¢åœ°è¿›è¡Œå¯åŠ¨é€Ÿåº¦çš„ä¼˜åŒ–äº†ã€‚è¿™äº›ä¼˜åŒ–ï¼ŒåŒ…æ‹¬äº†åŠŸèƒ½çº§åˆ«å’Œæ–¹æ³•çº§åˆ«çš„å¯åŠ¨ä¼˜åŒ–ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°±ä»è¿™ä¸¤ä¸ªè§’åº¦å±•å¼€çœ‹çœ‹ã€‚</p><h2>åŠŸèƒ½çº§åˆ«çš„å¯åŠ¨ä¼˜åŒ–</h2><p>æˆ‘æƒ³ï¼Œä½ æ‰€åœ¨çš„å›¢é˜Ÿä¸€å®šé¢ä¸´è¿‡å¯åŠ¨é˜¶æ®µçš„ä»£ç åŠŸèƒ½å †ç§¯ã€æ— è§„èŒƒã€éš¾ç»´æŠ¤çš„é—®é¢˜å§ã€‚åœ¨ App é¡¹ç›®å¼€å‘åˆæœŸï¼Œå¼€å‘äººå‘˜ä¸å¤šã€ä»£ç é‡ä¹Ÿæ²¡é‚£ä¹ˆå¤§æ—¶ï¼Œè¿™ç§æƒ…å†µæ¯”è¾ƒå°‘è§ã€‚ä½†åˆ°äº†åæœŸ ï¼ŒApp ä¸šåŠ¡è§„æ¨¡æ‰©å¤§ï¼Œå›¢é˜Ÿäººå‘˜æ°´å¹³å‚å·®ä¸é½ï¼Œå„ç§ä»£ç é—®é¢˜å°±ä¼šçˆ†å‘å‡ºæ¥ï¼Œç»ˆå½’éœ€è¦æ¥æ¬¡å…¨é¢æ²»ç†ã€‚</p><p>è€Œå…¨é¢æ²»ç†è¿‡ç¨‹ä¸­çš„æ‰‹æ®µã€æ–¹æ³•å’Œç¢°åˆ°çš„é—®é¢˜ï¼Œå¯¹äºåé¢çš„è§„èŒƒåˆ¶å®šä»¥åŠå¯åŠ¨é€Ÿåº¦ç›‘æ§éƒ½æœ‰ç€é‡è¦çš„æ„ä¹‰ã€‚é‚£ä¹ˆï¼Œæˆ‘ä»¬è¦æ€æ ·ä»åŠŸèƒ½çº§åˆ«æ¥è¿›è¡Œå…¨é¢çš„å¯åŠ¨ä¼˜åŒ–æ²»ç†å‘¢ï¼Ÿ</p><p>åŠŸèƒ½çº§åˆ«çš„å¯åŠ¨ä¼˜åŒ–ï¼Œå°±æ˜¯è¦ä»main() å‡½æ•°æ‰§è¡Œåè¿™ä¸ªé˜¶æ®µä¸‹æ‰‹ã€‚</p><p>ä¼˜åŒ–çš„æ€è·¯æ˜¯ï¼š main() å‡½æ•°å¼€å§‹æ‰§è¡Œååˆ°é¦–å±æ¸²æŸ“å®Œæˆå‰åªå¤„ç†é¦–å±ç›¸å…³çš„ä¸šåŠ¡ï¼Œå…¶ä»–éé¦–å±ä¸šåŠ¡çš„åˆå§‹åŒ–ã€ç›‘å¬æ³¨å†Œã€é…ç½®æ–‡ä»¶è¯»å–ç­‰éƒ½æ”¾åˆ°é¦–å±æ¸²æŸ“å®Œæˆåå»åšã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="https://static001.geekbang.org/resource/image/f3/19/f30f438d447e81132dd520e657427419.png" alt=""></p><center><span class="reference">å›¾2 åŠŸèƒ½çº§åˆ«çš„å¯åŠ¨ä¼˜åŒ–ç¤ºæ„å›¾</span></center><h2>æ–¹æ³•çº§åˆ«çš„å¯åŠ¨ä¼˜åŒ–</h2><p>ç»è¿‡åŠŸèƒ½çº§åˆ«çš„å¯åŠ¨ä¼˜åŒ–ï¼Œä¹Ÿå°±æ˜¯å°†éé¦–å±ä¸šåŠ¡æ‰€éœ€çš„åŠŸèƒ½æ»åä»¥åï¼Œä»ç”¨æˆ·ç‚¹å‡» App åˆ°çœ‹åˆ°é¦–å±çš„æ—¶é—´å°†ä¼šæœ‰å¾ˆå¤§ç¨‹åº¦çš„ç¼©çŸ­ï¼Œä¹Ÿå°±è¾¾åˆ°äº†ä¼˜åŒ–Appå¯åŠ¨é€Ÿåº¦çš„ç›®çš„ã€‚</p><p>åœ¨è¿™ä¹‹åï¼Œæˆ‘ä»¬éœ€è¦è¿›ä¸€æ­¥åšçš„ï¼Œæ˜¯æ£€æŸ¥é¦–å±æ¸²æŸ“å®Œæˆå‰ä¸»çº¿ç¨‹ä¸Šæœ‰å“ªäº›è€—æ—¶æ–¹æ³•ï¼Œå°†æ²¡å¿…è¦çš„è€—æ—¶æ–¹æ³•æ»åæˆ–è€…å¼‚æ­¥æ‰§è¡Œã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œè€—æ—¶è¾ƒé•¿çš„æ–¹æ³•ä¸»è¦å‘ç”Ÿåœ¨è®¡ç®—å¤§é‡æ•°æ®çš„æƒ…å†µä¸‹ï¼Œå…·ä½“çš„è¡¨ç°å°±æ˜¯åŠ è½½ã€ç¼–è¾‘ã€å­˜å‚¨å›¾ç‰‡å’Œæ–‡ä»¶ç­‰èµ„æºã€‚</p><p>é‚£ä¹ˆï¼Œä½ è§‰å¾—<strong>æ˜¯ä¸æ˜¯åªéœ€è¦ä¼˜åŒ–å¯¹èµ„æºçš„æ“ä½œå°±å¯ä»¥äº†å‘¢ï¼Ÿ</strong></p><p>å½“ç„¶ä¸æ˜¯ã€‚å°±åƒ +load() æ–¹æ³•ï¼Œä¸€ä¸ªè€—æ—¶4æ¯«ç§’ï¼Œ100ä¸ªå°±æ˜¯400æ¯«ç§’ï¼Œè¿™ç§è€—æ—¶ç”¨æˆ·ä¹Ÿæ˜¯èƒ½æ˜æ˜¾æ„ŸçŸ¥åˆ°çš„ã€‚</p><p>æ¯”å¦‚ï¼Œæˆ‘ä»¥å‰ä½¿ç”¨çš„ ReactiveCocoaæ¡†æ¶ï¼ˆè¿™æ˜¯ä¸€ä¸ª iOS ä¸Šçš„å“åº”å¼ç¼–ç¨‹æ¡†æ¶ï¼‰ï¼Œæ¯åˆ›å»ºä¸€ä¸ªä¿¡å·éƒ½æœ‰6æ¯«ç§’çš„è€—æ—¶ã€‚è¿™æ ·ï¼Œç¨ä¸æ³¨æ„å„ç§ä¿¡å·çš„åˆ›å»ºå°±éƒ½è¢«æ”¾åœ¨äº†é¦–å±æ¸²æŸ“å®Œæˆå‰ï¼Œè¿›è€Œå¯¼è‡´Appçš„å¯åŠ¨é€Ÿåº¦å¤§å¹…å˜æ…¢ã€‚</p><p>ç±»ä¼¼è¿™æ ·å•ä¸ªæ–¹æ³•è€—æ—¶ä¸å¤šï¼Œä½†æ˜¯ç”±äºå †ç§¯å¯¼è‡´Appå¯åŠ¨é€Ÿåº¦å¤§å¹…å˜æ…¢çš„æ–¹æ³•æ•°ä¸èƒœæ•°ã€‚æ‰€ä»¥ï¼Œä½ éœ€è¦ä¸€ä¸ªèƒ½å¤Ÿå¯¹å¯åŠ¨æ–¹æ³•è€—æ—¶è¿›è¡Œå…¨é¢ã€ç²¾ç¡®æ£€æŸ¥çš„æ‰‹æ®µã€‚</p><p>é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œæœ‰å“ªäº›ç›‘æ§æ‰‹æ®µï¼Ÿè¿™äº›ç›‘æ§æ‰‹æ®µå„æœ‰ä»€ä¹ˆä¼˜ç¼ºç‚¹ï¼Ÿä½ åˆè¯¥å¦‚ä½•é€‰æ‹©å‘¢ï¼Ÿ</p><p>ç›®å‰æ¥çœ‹ï¼Œå¯¹Appå¯åŠ¨é€Ÿåº¦çš„ç›‘æ§ï¼Œä¸»è¦æœ‰ä¸¤ç§æ‰‹æ®µã€‚</p><p><strong>ç¬¬ä¸€ç§æ–¹æ³•æ˜¯ï¼Œå®šæ—¶æŠ“å–ä¸»çº¿ç¨‹ä¸Šçš„æ–¹æ³•è°ƒç”¨å †æ ˆï¼Œè®¡ç®—ä¸€æ®µæ—¶é—´é‡Œå„ä¸ªæ–¹æ³•çš„è€—æ—¶</strong>ã€‚Xcode å·¥å…·å¥—ä»¶é‡Œè‡ªå¸¦çš„ Time Profiler ï¼Œé‡‡ç”¨çš„å°±æ˜¯è¿™ç§æ–¹å¼ã€‚</p><p>è¿™ç§æ–¹å¼çš„ä¼˜ç‚¹æ˜¯ï¼Œå¼€å‘ç±»ä¼¼å·¥å…·æˆæœ¬ä¸é«˜ï¼Œèƒ½å¤Ÿå¿«é€Ÿå¼€å‘åé›†æˆåˆ°ä½ çš„ App ä¸­ï¼Œä»¥ä¾¿åœ¨çœŸå®ç¯å¢ƒä¸­è¿›è¡Œæ£€æŸ¥ã€‚</p><p>è¯´åˆ°å®šæ—¶æŠ“å–ï¼Œå°±ä¼šæ¶‰åŠåˆ°å®šæ—¶é—´éš”çš„é•¿çŸ­é—®é¢˜ã€‚</p><ul>
<li>å®šæ—¶é—´éš”è®¾ç½®å¾—é•¿äº†ï¼Œä¼šæ¼æ‰ä¸€äº›æ–¹æ³•ï¼Œä»è€Œå¯¼è‡´æ£€æŸ¥å‡ºæ¥çš„è€—æ—¶ä¸ç²¾ç¡®ï¼›</li>
<li>è€Œå®šæ—¶é—´éš”è®¾ç½®å¾—çŸ­äº†ï¼ŒæŠ“å–å †æ ˆè¿™ä¸ªæ–¹æ³•æœ¬èº«è°ƒç”¨è¿‡å¤šä¹Ÿä¼šå½±å“æ•´ä½“è€—æ—¶ï¼Œå¯¼è‡´ç»“æœä¸å‡†ç¡®ã€‚</li>
</ul><p>è¿™ä¸ªå®šæ—¶é—´éš”å¦‚æœå°äºæ‰€æœ‰æ–¹æ³•æ‰§è¡Œçš„æ—¶é—´ï¼ˆæ¯”å¦‚ 0.002ç§’ï¼‰ï¼Œé‚£ä¹ˆåŸºæœ¬å°±èƒ½ç›‘æ§åˆ°æ‰€æœ‰æ–¹æ³•ã€‚ä½†è¿™æ ·åšçš„è¯ï¼Œæ•´ä½“çš„è€—æ—¶æ—¶é—´å°±ä¸å¤Ÿå‡†ç¡®ã€‚ä¸€èˆ¬å°†è¿™ä¸ªå®šæ—¶é—´éš”è®¾ç½®ä¸º0.01ç§’ã€‚è¿™æ ·è®¾ç½®ï¼Œå¯¹æ•´ä½“è€—æ—¶çš„å½±å“å°ï¼Œä¸è¿‡å¾ˆå¤šæ–¹æ³•è€—æ—¶å°±ä¸ç²¾ç¡®äº†ã€‚ä½†å› ä¸ºæ•´ä½“è€—æ—¶çš„æ•°æ®æ›´åŠ é‡è¦äº›ï¼Œå•ä¸ªæ–¹æ³•è€—æ—¶ç²¾åº¦ä¸é«˜ä¹Ÿæ˜¯å¯ä»¥æ¥å—çš„ï¼Œæ‰€ä»¥è¿™ä¸ªè®¾ç½®ä¹Ÿæ˜¯æ²¡é—®é¢˜çš„ã€‚</p><p>æ€»ç»“æ¥è¯´ï¼Œå®šæ—¶æŠ“å–ä¸»çº¿ç¨‹è°ƒç”¨æ ˆçš„æ–¹å¼è™½ç„¶ç²¾å‡†åº¦ä¸å¤Ÿé«˜ï¼Œä½†ä¹Ÿæ˜¯å¤Ÿç”¨çš„ã€‚</p><p><strong>ç¬¬äºŒç§æ–¹æ³•æ˜¯ï¼Œå¯¹ objc_msgSend æ–¹æ³•è¿›è¡Œ hook æ¥æŒæ¡æ‰€æœ‰æ–¹æ³•çš„æ‰§è¡Œè€—æ—¶ã€‚</strong></p><p>hook æ–¹æ³•çš„æ„æ€æ˜¯ï¼Œåœ¨åŸæ–¹æ³•å¼€å§‹æ‰§è¡Œæ—¶æ¢æˆæ‰§è¡Œå…¶ä»–ä½ æŒ‡å®šçš„æ–¹æ³•ï¼Œæˆ–è€…åœ¨åŸæœ‰æ–¹æ³•æ‰§è¡Œå‰åæ‰§è¡Œä½ æŒ‡å®šçš„æ–¹æ³•ï¼Œæ¥è¾¾åˆ°æŒæ¡å’Œæ”¹å˜æŒ‡å®šæ–¹æ³•çš„ç›®çš„ã€‚</p><p>hook objc_msgSend è¿™ç§æ–¹å¼çš„ä¼˜ç‚¹æ˜¯éå¸¸ç²¾ç¡®ï¼Œè€Œç¼ºç‚¹æ˜¯åªèƒ½é’ˆå¯¹ Objective-C çš„æ–¹æ³•ã€‚å½“ç„¶ï¼Œå¯¹äº c æ–¹æ³•å’Œ block ä¹Ÿä¸æ˜¯æ²¡æœ‰åŠæ³•ï¼Œä½ å¯ä»¥ä½¿ç”¨ libffi çš„ ffi_call æ¥è¾¾æˆ hookï¼Œä½†ç¼ºç‚¹å°±æ˜¯ç¼–å†™ç»´æŠ¤ç›¸å…³å·¥å…·é—¨æ§›é«˜ã€‚</p><p>å…³äºï¼Œlibffi ç›¸å…³çš„å†…å®¹ï¼Œæˆ‘ä¼šåœ¨åé¢çš„ç¬¬35ç¯‡æ–‡ç« â€œlibffiï¼šåŠ¨æ€è°ƒç”¨å’Œå®šä¹‰ C å‡½æ•°â€é‡Œå’Œä½ è¯¦ç»†è¯´æ˜ã€‚</p><p>ç»¼ä¸Šï¼Œå¦‚æœå¯¹äºæ£€æŸ¥ç»“æœç²¾å‡†åº¦è¦æ±‚é«˜çš„è¯ï¼Œæˆ‘æ¯”è¾ƒæ¨èä½ ä½¿ç”¨ hook objc_msgSend æ–¹å¼æ¥æ£€æŸ¥å¯åŠ¨æ–¹æ³•çš„æ‰§è¡Œè€—æ—¶ã€‚</p><h2>å¦‚ä½•åšä¸€ä¸ªæ–¹æ³•çº§åˆ«å¯åŠ¨è€—æ—¶æ£€æŸ¥å·¥å…·æ¥è¾…åŠ©åˆ†æå’Œç›‘æ§ï¼Ÿ</h2><p>ä½¿ç”¨ hook objc_msgSend æ–¹å¼æ¥æ£€æŸ¥å¯åŠ¨æ–¹æ³•çš„æ‰§è¡Œè€—æ—¶æ—¶ï¼Œæˆ‘ä»¬éœ€è¦å®ç°ä¸€ä¸ªç§°æ‰‹çš„å¯åŠ¨æ—¶é—´æ£€æŸ¥å·¥å…·ã€‚é‚£ä¹ˆï¼Œæˆ‘ä»¬åº”è¯¥å¦‚ä½•å®ç°è¿™ä¸ªå·¥å…·å‘¢ï¼Ÿ</p><p>ç°åœ¨ï¼Œæˆ‘å°±ä¸€æ­¥ä¸€æ­¥åœ°å’Œä½ è¯´è¯´å…·ä½“æ€ä¹ˆåšã€‚</p><p>é¦–å…ˆï¼Œä½ è¦äº†è§£<strong>ä¸ºä»€ä¹ˆ hook äº† objc_msgSend æ–¹æ³•ï¼Œå°±å¯ä»¥ hook å…¨éƒ¨ Objective-C çš„æ–¹æ³•ï¼Ÿ</strong></p><p>Objective-C é‡Œæ¯ä¸ªå¯¹è±¡éƒ½ä¼šæŒ‡å‘ä¸€ä¸ªç±»ï¼Œæ¯ä¸ªç±»éƒ½ä¼šæœ‰ä¸€ä¸ªæ–¹æ³•åˆ—è¡¨ï¼Œæ–¹æ³•åˆ—è¡¨é‡Œçš„æ¯ä¸ªæ–¹æ³•éƒ½æ˜¯ç”± selectorã€å‡½æ•°æŒ‡é’ˆå’Œ metadata ç»„æˆçš„ã€‚</p><p>objc_msgSend æ–¹æ³•å¹²çš„æ´»å„¿ï¼Œå°±æ˜¯åœ¨è¿è¡Œæ—¶æ ¹æ®å¯¹è±¡å’Œæ–¹æ³•çš„selector å»æ‰¾åˆ°å¯¹åº”çš„å‡½æ•°æŒ‡é’ˆï¼Œç„¶åæ‰§è¡Œã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œobjc_msgSend æ˜¯ Objective-C é‡Œæ–¹æ³•æ‰§è¡Œçš„å¿…ç»ä¹‹è·¯ï¼Œèƒ½å¤Ÿæ§åˆ¶æ‰€æœ‰çš„ Objective-C çš„æ–¹æ³•ã€‚</p><p>objc_msgSend æœ¬èº«æ˜¯ç”¨æ±‡ç¼–è¯­è¨€å†™çš„ï¼Œè¿™æ ·åšçš„åŸå› ä¸»è¦æœ‰ä¸¤ä¸ªï¼š</p><ul>
<li>ä¸€ä¸ªåŸå› æ˜¯ï¼Œobjc_msgSend çš„è°ƒç”¨é¢‘æ¬¡æœ€é«˜ï¼Œåœ¨å®ƒä¸Šé¢è¿›è¡Œçš„æ€§èƒ½ä¼˜åŒ–èƒ½å¤Ÿæå‡æ•´ä¸ª App ç”Ÿå‘½å‘¨æœŸçš„æ€§èƒ½ã€‚è€Œæ±‡ç¼–è¯­è¨€åœ¨æ€§èƒ½ä¼˜åŒ–ä¸Šå±äºåŸå­çº§ä¼˜åŒ–ï¼Œèƒ½å¤ŸæŠŠä¼˜åŒ–åšåˆ°æè‡´ã€‚æ‰€ä»¥ï¼Œè¿™ç§æŠ•å…¥äº§å‡ºæ¯”æ— ç–‘æ˜¯æœ€å¤§çš„ã€‚</li>
<li>å¦ä¸€ä¸ªåŸå› æ˜¯ï¼Œå…¶ä»–è¯­è¨€éš¾ä»¥å®ç°æœªçŸ¥å‚æ•°è·³è½¬åˆ°ä»»æ„å‡½æ•°æŒ‡é’ˆçš„åŠŸèƒ½ã€‚</li>
</ul><p>ç°åœ¨ï¼Œè‹¹æœå…¬å¸å·²ç»å¼€æºäº†Objective-C çš„è¿è¡Œæ—¶ä»£ç ã€‚ä½ å¯ä»¥åœ¨<a href="https://opensource.apple.com/source/objc4/objc4-723/runtime/Messengers.subproj/">è‹¹æœå…¬å¸çš„å¼€æºç½‘ç«™</a>ï¼Œæ‰¾åˆ° objc_msgSendçš„æºç ã€‚</p><p><img src="https://static001.geekbang.org/resource/image/70/b1/70b693ee775c26cb8b9dd3350fe1b3b1.png" alt=""></p><center><span class="reference">å›¾3 objc_msgSend å…¨æ¶æ„å®ç°æºä»£ç æ–‡ä»¶åˆ—è¡¨</span></center><p>ä¸Šå›¾åˆ—å‡ºçš„æ˜¯æ‰€æœ‰æ¶æ„çš„å®ç°ï¼ŒåŒ…æ‹¬ x86_64 ç­‰ã€‚objc_msgSend æ˜¯ iOS æ–¹å¼æ‰§è¡Œæœ€æ ¸å¿ƒçš„éƒ¨åˆ†ï¼Œç¼–ç¨‹é¢†åŸŸçš„å®è—ï¼Œå€¼å¾—ä½ æ·±å…¥æ¢ç©¶å’Œç»†ç»†å“å‘³ã€‚</p><p>objc_msgSendæ–¹æ³•æ‰§è¡Œçš„é€»è¾‘æ˜¯ï¼šå…ˆè·å–å¯¹è±¡å¯¹åº”ç±»çš„ä¿¡æ¯ï¼Œå†è·å–æ–¹æ³•çš„ç¼“å­˜ï¼Œæ ¹æ®æ–¹æ³•çš„selector æŸ¥æ‰¾å‡½æ•°æŒ‡é’ˆï¼Œç»è¿‡å¼‚å¸¸é”™è¯¯å¤„ç†åï¼Œæœ€åè·³åˆ°å¯¹åº”å‡½æ•°çš„å®ç°ã€‚</p><p>æŒ‰ç…§è¿™ä¸ªé€»è¾‘å»çœ‹æºç ä¼šæ›´åŠ æ¸…æ™°ï¼Œæ›´å®¹æ˜“æ³¨æ„åˆ°å®ç°ç»†èŠ‚ã€‚é˜…è¯» objc_msgSend æºç æ˜¯ç¼–å†™æ–¹æ³•çº§è€—æ—¶å·¥å…·çš„ä¸€ä¸ªå¿…è¦çš„ç¯èŠ‚ï¼Œåé¢è¿˜éœ€è¦ç¼–å†™ä¸€äº›å¯¹åº”çš„æ±‡ç¼–ä»£ç ã€‚</p><p><strong>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å†çœ‹çœ‹æ€ä¹ˆ hook objc_msgSend æ–¹æ³•ï¼Ÿ</strong></p><p>Facebook å¼€æºäº†ä¸€ä¸ªåº“ï¼Œå¯ä»¥åœ¨iOSä¸Šè¿è¡Œçš„Mach-OäºŒè¿›åˆ¶æ–‡ä»¶ä¸­åŠ¨æ€åœ°é‡æ–°ç»‘å®šç¬¦å·ï¼Œè¿™ä¸ªåº“å« fishhookã€‚ä½ å¯ä»¥åœ¨GitHub ä¸Šï¼ŒæŸ¥çœ‹<a href="https://github.com/facebook/fishhook">fishhookçš„ä»£ç </a>ã€‚</p><p>fishhook å®ç°çš„å¤§è‡´æ€è·¯æ˜¯ï¼Œé€šè¿‡é‡æ–°ç»‘å®šç¬¦å·ï¼Œå¯ä»¥å®ç°å¯¹ c æ–¹æ³•çš„ hookã€‚dyld æ˜¯é€šè¿‡æ›´æ–° Mach-O äºŒè¿›åˆ¶çš„ __DATA segment ç‰¹å®šçš„éƒ¨åˆ†ä¸­çš„æŒ‡é’ˆæ¥ç»‘å®š lazy å’Œ non-lazy ç¬¦å·ï¼Œé€šè¿‡ç¡®è®¤ä¼ é€’ç»™ rebind_symbol é‡Œæ¯ä¸ªç¬¦å·åç§°æ›´æ–°çš„ä½ç½®ï¼Œå°±å¯ä»¥æ‰¾å‡ºå¯¹åº”æ›¿æ¢æ¥é‡æ–°ç»‘å®šè¿™äº›ç¬¦å·ã€‚</p><p>ä¸‹é¢ï¼Œæˆ‘é’ˆå¯¹ fishhook é‡Œçš„å…³é”®ä»£ç ï¼Œå’Œä½ å…·ä½“è¯´ä¸‹ fishhook çš„å®ç°åŸç†ã€‚</p><p><strong>é¦–å…ˆ</strong>ï¼Œéå† dyld é‡Œçš„æ‰€æœ‰imageï¼Œå–å‡º image header å’Œ slideã€‚ä»£ç å¦‚ä¸‹ï¼š</p><pre><code>if (!_rebindings_head-&gt;next) {
    _dyld_register_func_for_add_image(_rebind_symbols_for_image);
} else {
    uint32_t c = _dyld_image_count();
    // éå†æ‰€æœ‰ image
    for (uint32_t i = 0; i &lt; c; i++) {
        // è¯»å– image header å’Œ slider
        _rebind_symbols_for_image(_dyld_get_image_header(i), _dyld_get_image_vmaddr_slide(i));
    }
}
</code></pre><p><strong>æ¥ä¸‹æ¥</strong>ï¼Œæ‰¾åˆ°ç¬¦å·è¡¨ç›¸å…³çš„ commandï¼ŒåŒ…æ‹¬ linkedit segment commandã€symtab command å’Œ dysymtab commandã€‚ä»£ç å¦‚ä¸‹ï¼š</p><pre><code>segment_command_t *cur_seg_cmd;
segment_command_t *linkedit_segment = NULL;
struct symtab_command* symtab_cmd = NULL;
struct dysymtab_command* dysymtab_cmd = NULL;
uintptr_t cur = (uintptr_t)header + sizeof(mach_header_t);
for (uint i = 0; i &lt; header-&gt;ncmds; i++, cur += cur_seg_cmd-&gt;cmdsize) {
    cur_seg_cmd = (segment_command_t *)cur;
    if (cur_seg_cmd-&gt;cmd == LC_SEGMENT_ARCH_DEPENDENT) {
        if (strcmp(cur_seg_cmd-&gt;segname, SEG_LINKEDIT) == 0) {
            // linkedit segment command
            linkedit_segment = cur_seg_cmd;
        }
    } else if (cur_seg_cmd-&gt;cmd == LC_SYMTAB) {
        // symtab command
        symtab_cmd = (struct symtab_command*)cur_seg_cmd;
    } else if (cur_seg_cmd-&gt;cmd == LC_DYSYMTAB) {
        // dysymtab command
        dysymtab_cmd = (struct dysymtab_command*)cur_seg_cmd;
    }
}
</code></pre><p><strong>ç„¶åï¼Œ</strong>è·å¾— base å’Œ indirect ç¬¦å·è¡¨ã€‚å®ç°ä»£ç å¦‚ä¸‹ï¼š</p><pre><code>// æ‰¾åˆ° base ç¬¦å·è¡¨çš„åœ°å€
uintptr_t linkedit_base = (uintptr_t)slide + linkedit_segment-&gt;vmaddr - linkedit_segment-&gt;fileoff;
nlist_t *symtab = (nlist_t *)(linkedit_base + symtab_cmd-&gt;symoff);
char *strtab = (char *)(linkedit_base + symtab_cmd-&gt;stroff);
// æ‰¾åˆ° indirect ç¬¦å·è¡¨
uint32_t *indirect_symtab = (uint32_t *)(linkedit_base + dysymtab_cmd-&gt;indirectsymoff);
</code></pre><p><strong>æœ€åï¼Œ</strong>æœ‰äº†ç¬¦å·è¡¨å’Œä¼ å…¥çš„æ–¹æ³•æ›¿æ¢æ•°ç»„ï¼Œå°±å¯ä»¥è¿›è¡Œç¬¦å·è¡¨è®¿é—®æŒ‡é’ˆåœ°å€çš„æ›¿æ¢äº†ï¼Œå…·ä½“å®ç°å¦‚ä¸‹ï¼š</p><pre><code>uint32_t *indirect_symbol_indices = indirect_symtab + section-&gt;reserved1;
void **indirect_symbol_bindings = (void **)((uintptr_t)slide + section-&gt;addr);
for (uint i = 0; i &lt; section-&gt;size / sizeof(void *); i++) {
    uint32_t symtab_index = indirect_symbol_indices[i];
    if (symtab_index == INDIRECT_SYMBOL_ABS || symtab_index == INDIRECT_SYMBOL_LOCAL ||
        symtab_index == (INDIRECT_SYMBOL_LOCAL   | INDIRECT_SYMBOL_ABS)) {
        continue;
    }
    uint32_t strtab_offset = symtab[symtab_index].n_un.n_strx;
    char *symbol_name = strtab + strtab_offset;
    if (strnlen(symbol_name, 2) &lt; 2) {
        continue;
    }
    struct rebindings_entry *cur = rebindings;
    while (cur) {
        for (uint j = 0; j &lt; cur-&gt;rebindings_nel; j++) {
            if (strcmp(&amp;symbol_name[1], cur-&gt;rebindings[j].name) == 0) {
                if (cur-&gt;rebindings[j].replaced != NULL &amp;&amp;
                    indirect_symbol_bindings[i] != cur-&gt;rebindings[j].replacement) {
                    *(cur-&gt;rebindings[j].replaced) = indirect_symbol_bindings[i];
                }
                // ç¬¦å·è¡¨è®¿é—®æŒ‡é’ˆåœ°å€çš„æ›¿æ¢
                indirect_symbol_bindings[i] = cur-&gt;rebindings[j].replacement;
                goto symbol_loop;
            }
        }
        cur = cur-&gt;next;
    }
symbol_loop:;
</code></pre><p>ä»¥ä¸Šï¼Œå°±æ˜¯ fishhook çš„å®ç°åŸç†äº†ã€‚fishhook æ˜¯å¯¹åº•å±‚çš„æ“ä½œï¼Œå…¶ä¸­æŸ¥æ‰¾ç¬¦å·è¡¨çš„è¿‡ç¨‹å’Œå †æ ˆç¬¦å·åŒ–å®ç°åŸç†åŸºæœ¬ç±»ä¼¼ï¼Œäº†è§£äº†å…¶ä¸­åŸç†å¯¹äºç†è§£å¯æ‰§è¡Œæ–‡ä»¶ Mach-O å†…éƒ¨ç»“æ„ä¼šæœ‰å¾ˆå¤§çš„å¸®åŠ©ã€‚</p><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å†çœ‹ä¸€ä¸ªé—®é¢˜ï¼š<strong>åªé  fishhook å°±èƒ½å¤Ÿæå®š objc_msgSend çš„ hook äº†å—ï¼Ÿ</strong></p><p>å½“ç„¶è¿˜ä¸å¤Ÿã€‚æˆ‘å‰é¢ä¹Ÿè¯´äº†ï¼Œobjc_msgSend æ˜¯ç”¨æ±‡ç¼–è¯­è¨€å®ç°çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿˜éœ€è¦ä»æ±‡ç¼–å±‚é¢å¤šåŠ ç‚¹æ–™ã€‚</p><p>ä½ éœ€è¦å…ˆå®ç°ä¸¤ä¸ªæ–¹æ³• pushCallRecord å’Œ popCallRecordï¼Œæ¥åˆ†åˆ«è®°å½• objc_msgSend æ–¹æ³•è°ƒç”¨å‰åçš„æ—¶é—´ï¼Œç„¶åç›¸å‡å°±èƒ½å¤Ÿå¾—åˆ°æ–¹æ³•çš„æ‰§è¡Œè€—æ—¶ã€‚</p><p>ä¸‹é¢æˆ‘é’ˆå¯¹arm64æ¶æ„ï¼Œç¼–å†™ä¸€ä¸ªå¯ä¿ç•™æœªçŸ¥å‚æ•°å¹¶è·³è½¬åˆ° c ä¸­ä»»æ„å‡½æ•°æŒ‡é’ˆçš„æ±‡ç¼–ä»£ç ï¼Œå®ç°å¯¹ objc_msgSend çš„ Hookã€‚</p><p>arm64 æœ‰31ä¸ª64 bit çš„æ•´æ•°å‹å¯„å­˜å™¨ï¼Œåˆ†åˆ«ç”¨ x0 åˆ° x30 è¡¨ç¤ºã€‚ä¸»è¦çš„å®ç°æ€è·¯æ˜¯ï¼š</p><ol>
<li>
<p>å…¥æ ˆå‚æ•°ï¼Œå‚æ•°å¯„å­˜å™¨æ˜¯ x0~ x7ã€‚å¯¹äºobjc_msgSendæ–¹æ³•æ¥è¯´ï¼Œx0 ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ä¼ å…¥å¯¹è±¡ï¼Œx1 ç¬¬äºŒä¸ªå‚æ•°æ˜¯é€‰æ‹©å™¨ _cmdã€‚syscall çš„ number ä¼šæ”¾åˆ° x8 é‡Œã€‚</p>
</li>
<li>
<p>äº¤æ¢å¯„å­˜å™¨ä¸­ä¿å­˜çš„å‚æ•°ï¼Œå°†ç”¨äºè¿”å›çš„å¯„å­˜å™¨ lr ä¸­çš„æ•°æ®ç§»åˆ° x1 é‡Œã€‚</p>
</li>
<li>
<p>ä½¿ç”¨ bl label è¯­æ³•è°ƒç”¨ pushCallRecord å‡½æ•°ã€‚</p>
</li>
<li>
<p>æ‰§è¡ŒåŸå§‹çš„ objc_msgSendï¼Œä¿å­˜è¿”å›å€¼ã€‚</p>
</li>
<li>
<p>ä½¿ç”¨ bl label è¯­æ³•è°ƒç”¨ popCallRecord å‡½æ•°ã€‚</p>
</li>
</ol><p>å…·ä½“çš„æ±‡ç¼–ä»£ç ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><pre><code>static void replacementObjc_msgSend() {
  __asm__ volatile (
    // sp æ˜¯å †æ ˆå¯„å­˜å™¨ï¼Œå­˜æ”¾æ ˆçš„åç§»åœ°å€ï¼Œæ¯æ¬¡éƒ½æŒ‡å‘æ ˆé¡¶ã€‚
    // ä¿å­˜ {q0-q7} åç§»åœ°å€åˆ° sp å¯„å­˜å™¨
      &quot;stp q6, q7, [sp, #-32]!\n&quot;
      &quot;stp q4, q5, [sp, #-32]!\n&quot;
      &quot;stp q2, q3, [sp, #-32]!\n&quot;
      &quot;stp q0, q1, [sp, #-32]!\n&quot;
    // ä¿å­˜ {x0-x8, lr}
      &quot;stp x8, lr, [sp, #-16]!\n&quot;
      &quot;stp x6, x7, [sp, #-16]!\n&quot;
      &quot;stp x4, x5, [sp, #-16]!\n&quot;
      &quot;stp x2, x3, [sp, #-16]!\n&quot;
      &quot;stp x0, x1, [sp, #-16]!\n&quot;
    // äº¤æ¢å‚æ•°.
      &quot;mov x2, x1\n&quot;
      &quot;mov x1, lr\n&quot;
      &quot;mov x3, sp\n&quot;
    // è°ƒç”¨ preObjc_msgSendï¼Œä½¿ç”¨ bl label è¯­æ³•ã€‚bl æ‰§è¡Œä¸€ä¸ªåˆ†æ”¯é“¾æ¥æ“ä½œï¼Œlabel æ˜¯æ— æ¡ä»¶åˆ†æ”¯çš„ï¼Œæ˜¯å’Œæœ¬æŒ‡ä»¤çš„åœ°å€åç§»ï¼ŒèŒƒå›´æ˜¯ -128MB åˆ° +128MB
      &quot;bl __Z15preObjc_msgSendP11objc_objectmP13objc_selectorP9RegState_\n&quot;
      &quot;mov x9, x0\n&quot;
      &quot;mov x10, x1\n&quot;
      &quot;tst x10, x10\n&quot;
    // è¯»å– {x0-x8, lr} ä»ä¿å­˜åˆ° sp æ ˆé¡¶çš„åç§»åœ°å€è¯»èµ·
      &quot;ldp x0, x1, [sp], #16\n&quot;
      &quot;ldp x2, x3, [sp], #16\n&quot;
      &quot;ldp x4, x5, [sp], #16\n&quot;
      &quot;ldp x6, x7, [sp], #16\n&quot;
      &quot;ldp x8, lr, [sp], #16\n&quot;
    // è¯»å– {q0-q7}
      &quot;ldp q0, q1, [sp], #32\n&quot;
      &quot;ldp q2, q3, [sp], #32\n&quot;
      &quot;ldp q4, q5, [sp], #32\n&quot;
      &quot;ldp q6, q7, [sp], #32\n&quot;
      &quot;b.eq Lpassthrough\n&quot;
    // è°ƒç”¨åŸå§‹ objc_msgSendã€‚ä½¿ç”¨ blr xn è¯­æ³•ã€‚blr é™¤äº†ä»æŒ‡å®šå¯„å­˜å™¨è¯»å–æ–°çš„ PC å€¼å¤–æ•ˆæœå’Œ bl ä¸€æ ·ã€‚xn æ˜¯é€šç”¨å¯„å­˜å™¨çš„64ä½åç§°åˆ†æ”¯åœ°å€ï¼ŒèŒƒå›´æ˜¯0åˆ°31
      &quot;blr x9\n&quot;
    // ä¿å­˜ {x0-x9}
      &quot;stp x0, x1, [sp, #-16]!\n&quot;
      &quot;stp x2, x3, [sp, #-16]!\n&quot;
      &quot;stp x4, x5, [sp, #-16]!\n&quot;
      &quot;stp x6, x7, [sp, #-16]!\n&quot;
      &quot;stp x8, x9, [sp, #-16]!\n&quot;
    // ä¿å­˜ {q0-q7}
      &quot;stp q0, q1, [sp, #-32]!\n&quot;
      &quot;stp q2, q3, [sp, #-32]!\n&quot;
      &quot;stp q4, q5, [sp, #-32]!\n&quot;
      &quot;stp q6, q7, [sp, #-32]!\n&quot;
    // è°ƒç”¨ postObjc_msgSend hook.
      &quot;bl __Z16postObjc_msgSendv\n&quot;
      &quot;mov lr, x0\n&quot;
    // è¯»å– {q0-q7}
      &quot;ldp q6, q7, [sp], #32\n&quot;
      &quot;ldp q4, q5, [sp], #32\n&quot;
      &quot;ldp q2, q3, [sp], #32\n&quot;
      &quot;ldp q0, q1, [sp], #32\n&quot;
    // è¯»å– {x0-x9}
      &quot;ldp x8, x9, [sp], #16\n&quot;
      &quot;ldp x6, x7, [sp], #16\n&quot;
      &quot;ldp x4, x5, [sp], #16\n&quot;
      &quot;ldp x2, x3, [sp], #16\n&quot;
      &quot;ldp x0, x1, [sp], #16\n&quot;
      &quot;ret\n&quot;
      &quot;Lpassthrough:\n&quot;
    // br æ— æ¡ä»¶åˆ†æ”¯åˆ°å¯„å­˜å™¨ä¸­çš„åœ°å€
      &quot;br x9&quot;
    );
}
</code></pre><p>ç°åœ¨ï¼Œä½ å°±å¯ä»¥å¾—åˆ°æ¯ä¸ª Objective-C æ–¹æ³•çš„è€—æ—¶äº†ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å†çœ‹çœ‹<strong>æ€æ ·æ‰èƒ½å¤Ÿåšåˆ°åƒä¸‹å›¾é‚£æ ·è®°å½•å’Œå±•ç¤ºæ–¹æ³•è°ƒç”¨çš„å±‚çº§å…³ç³»å’Œé¡ºåºå‘¢ï¼Ÿ</strong></p><p><img src="https://static001.geekbang.org/resource/image/b0/62/b08872e98b3090147d22d359a2a29062.png" alt=""></p><center><span class="reference">å›¾4 æ–¹æ³•è°ƒç”¨å±‚çº§å’Œé¡ºåº</span></center><p>ä¸è¦ç€æ€¥ï¼Œæˆ‘æ¥ä¸€æ­¥ä¸€æ­¥åœ°è·Ÿä½ è¯´ã€‚</p><p><strong>ç¬¬ä¸€æ­¥ï¼Œ</strong>è®¾è®¡ä¸¤ä¸ªç»“æ„ä½“ï¼šCallRecord è®°å½•è°ƒç”¨æ–¹æ³•è¯¦ç»†ä¿¡æ¯ï¼ŒåŒ…æ‹¬ obj å’Œ SEL ç­‰ï¼›ThreadCallStack é‡Œé¢ï¼Œéœ€è¦ç”¨ index è®°å½•å½“å‰è°ƒç”¨æ–¹æ³•æ ‘çš„æ·±åº¦ã€‚</p><p>æœ‰äº† SEL å†é€šè¿‡ NSStringFromSelector å°±èƒ½å¤Ÿå–å¾—æ–¹æ³•åï¼Œæœ‰äº† obj é€šè¿‡ object_getClass èƒ½å¤Ÿå¾—åˆ° Class ï¼Œå†ç”¨ NSStringFromClass å°±èƒ½å¤Ÿè·å¾—ç±»åã€‚ç»“æ„çš„å®Œæ•´ä»£ç å¦‚ä¸‹ï¼š</p><pre><code>// Shared structures.
typedef struct CallRecord_ {
  id obj;   //é€šè¿‡ object_getClass èƒ½å¤Ÿå¾—åˆ° Class å†é€šè¿‡ NSStringFromClass èƒ½å¤Ÿå¾—åˆ°ç±»å
  SEL _cmd; //é€šè¿‡ NSStringFromSelector æ–¹æ³•èƒ½å¤Ÿå¾—åˆ°æ–¹æ³•å
  uintptr_t lr;
  int prevHitIndex;
  char isWatchHit;
} CallRecord;
typedef struct ThreadCallStack_ {
  FILE *file;
  char *spacesStr;
  CallRecord *stack;
  int allocatedLength;
  int index; //index è®°å½•å½“å‰è°ƒç”¨æ–¹æ³•æ ‘çš„æ·±åº¦
  int numWatchHits;
  int lastPrintedIndex;
  int lastHitIndex;
  char isLoggingEnabled;
  char isCompleteLoggingEnabled;
} ThreadCallStack;
</code></pre><p><strong>ç¬¬äºŒæ­¥ï¼Œ</strong>pthread_setspecific() å¯ä»¥å°†ç§æœ‰æ•°æ®è®¾ç½®åœ¨æŒ‡å®šçº¿ç¨‹ä¸Šï¼Œpthread_getspecific() ç”¨æ¥è¯»å–è¿™ä¸ªç§æœ‰æ•°æ®ã€‚åˆ©ç”¨è¿™ä¸ªç‰¹æ€§ï¼Œæˆ‘ä»¬å°±å¯ä»¥å°† ThreadCallStack çš„æ•°æ®å’Œè¯¥çº¿ç¨‹ç»‘å®šåœ¨ä¸€èµ·ï¼Œéšæ—¶è¿›è¡Œæ•°æ®å­˜å–ã€‚ä»£ç å¦‚ä¸‹ï¼š</p><pre><code>static inline ThreadCallStack * getThreadCallStack() {
  ThreadCallStack *cs = (ThreadCallStack *)pthread_getspecific(threadKey); //è¯»å–
  if (cs == NULL) {
    cs = (ThreadCallStack *)malloc(sizeof(ThreadCallStack));
#ifdef MAIN_THREAD_ONLY
    cs-&gt;file = (pthread_main_np()) ? newFileForThread() : NULL;
#else
    cs-&gt;file = newFileForThread();
#endif
    cs-&gt;isLoggingEnabled = (cs-&gt;file != NULL);
    cs-&gt;isCompleteLoggingEnabled = 0;
    cs-&gt;spacesStr = (char *)malloc(DEFAULT_CALLSTACK_DEPTH + 1);
    memset(cs-&gt;spacesStr, ' ', DEFAULT_CALLSTACK_DEPTH);
    cs-&gt;spacesStr[DEFAULT_CALLSTACK_DEPTH] = '\0';
    cs-&gt;stack = (CallRecord *)calloc(DEFAULT_CALLSTACK_DEPTH, sizeof(CallRecord)); //åˆ†é… CallRecord é»˜è®¤ç©ºé—´
    cs-&gt;allocatedLength = DEFAULT_CALLSTACK_DEPTH;
    cs-&gt;index = cs-&gt;lastPrintedIndex = cs-&gt;lastHitIndex = -1;
    cs-&gt;numWatchHits = 0;
    pthread_setspecific(threadKey, cs); //ä¿å­˜æ•°æ®
  }
  return cs;
}
</code></pre><p><strong>ç¬¬ä¸‰æ­¥ï¼Œ</strong>å› ä¸ºè¦è®°å½•æ·±åº¦ï¼Œè€Œä¸€ä¸ªæ–¹æ³•çš„è°ƒç”¨é‡Œä¼šæœ‰æ›´å¤šçš„æ–¹æ³•è°ƒç”¨ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥åœ¨æ–¹æ³•çš„è°ƒç”¨é‡Œå¢åŠ ä¸¤ä¸ªæ–¹æ³• pushCallRecord å’Œ popCallRecordï¼Œåˆ†åˆ«è®°å½•æ–¹æ³•è°ƒç”¨çš„å¼€å§‹æ—¶é—´å’Œç»“æŸæ—¶é—´ï¼Œè¿™æ ·æ‰èƒ½å¤Ÿåœ¨å¼€å§‹æ—¶å¯¹æ·±åº¦åŠ ä¸€ã€åœ¨ç»“æŸæ—¶å‡ä¸€ã€‚</p><pre><code>//å¼€å§‹æ—¶
static inline void pushCallRecord(id obj, uintptr_t lr, SEL _cmd, ThreadCallStack *cs) {
  int nextIndex = (++cs-&gt;index); //å¢åŠ æ·±åº¦
  if (nextIndex &gt;= cs-&gt;allocatedLength) {
    cs-&gt;allocatedLength += CALLSTACK_DEPTH_INCREMENT;
    cs-&gt;stack = (CallRecord *)realloc(cs-&gt;stack, cs-&gt;allocatedLength * sizeof(CallRecord));
    cs-&gt;spacesStr = (char *)realloc(cs-&gt;spacesStr, cs-&gt;allocatedLength + 1);
    memset(cs-&gt;spacesStr, ' ', cs-&gt;allocatedLength);
    cs-&gt;spacesStr[cs-&gt;allocatedLength] = '\0';
  }
  CallRecord *newRecord = &amp;cs-&gt;stack[nextIndex];
  newRecord-&gt;obj = obj;
  newRecord-&gt;_cmd = _cmd;
  newRecord-&gt;lr = lr;
  newRecord-&gt;isWatchHit = 0;
}
//ç»“æŸæ—¶
static inline CallRecord * popCallRecord(ThreadCallStack *cs) {
  return &amp;cs-&gt;stack[cs-&gt;index--]; //å‡å°‘æ·±åº¦
}
</code></pre><p>è€—æ—¶æ£€æŸ¥çš„å®Œæ•´ä»£ç ï¼Œä½ å¯ä»¥åœ¨<a href="https://github.com/ming1016/GCDFetchFeed">æˆ‘çš„å¼€æºé¡¹ç›®</a>é‡ŒæŸ¥çœ‹ã€‚åœ¨éœ€è¦æ£€æµ‹è€—æ—¶æ—¶é—´çš„åœ°æ–¹è°ƒç”¨ [SMCallTrace start]ï¼Œç»“æŸæ—¶è°ƒç”¨ stop å’Œ save å°±å¯ä»¥æ‰“å°å‡ºæ–¹æ³•çš„è°ƒç”¨å±‚çº§å’Œè€—æ—¶äº†ã€‚ä½ è¿˜å¯ä»¥è®¾ç½®æœ€å¤§æ·±åº¦å’Œæœ€å°è€—æ—¶æ£€æµ‹ï¼Œæ¥è¿‡æ»¤ä¸éœ€è¦çœ‹åˆ°çš„ä¿¡æ¯ã€‚</p><p>æœ‰äº†è¿™æ ·ä¸€ä¸ªæ£€æŸ¥æ–¹æ³•è€—æ—¶çš„å·¥å…·ï¼Œä½ å°±å¯ä»¥åœ¨æ¯ä¸ªç‰ˆæœ¬å¼€å‘ç»“æŸåæ‰§è¡Œä¸€æ¬¡æ£€æŸ¥ï¼Œç»Ÿè®¡æ€»è€—æ—¶ä»¥åŠå¯åŠ¨é˜¶æ®µæ¯ä¸ªæ–¹æ³•çš„è€—æ—¶ï¼Œæœ‰é’ˆå¯¹æ€§åœ°è§‚å¯Ÿå¯åŠ¨é€Ÿåº¦æ…¢çš„é—®é¢˜ã€‚å¦‚æœä½ åœ¨çº¿ä¸Šåšä¸ªç°åº¦å¼€å…³ï¼Œè¿˜å¯ä»¥ç›‘æ§çº¿ä¸Šå¯åŠ¨æ…¢çš„ä¸€äº›ç‰¹æ®Šæƒ…å†µã€‚</p><h2>å°ç»“</h2><p>å¯åŠ¨é€Ÿåº¦ä¼˜åŒ–å’Œç›‘æ§çš„é‡è¦æ€§ä¸è¨€è€Œå–»ï¼ŒåŠ å¿« App çš„å¯åŠ¨é€Ÿåº¦å¯¹ç”¨æˆ·çš„ä½“éªŒæå‡æ˜¯æœ€å¤§çš„ã€‚</p><p>å¯åŠ¨é€Ÿåº¦çš„ä¼˜åŒ–ä¹Ÿæœ‰ç²—æœ‰ç»†ï¼šç²—ä¸Šæ¥è®²ï¼Œè¿™éœ€è¦å¯¹å¯åŠ¨é˜¶æ®µåŠŸèƒ½è¿›è¡Œåˆ†ç±»æ•´ç†ï¼Œåˆç†åœ°å°†å’Œé¦–å±æ— å…³çš„åŠŸèƒ½æ»åï¼Œæ”¾åˆ°é¦–å±æ¸²æŸ“å®Œæˆä¹‹åï¼Œä¿è¯å¤§å¤´å„¿æ²¡æœ‰é—®é¢˜ï¼›ç»†çš„æ¥è®²ï¼Œè¿™å°±éœ€è¦äº›åŒ äººç²¾ç¥ï¼Œä½¿ç”¨åˆé€‚çš„å·¥å…·ï¼Œé’ˆå¯¹æ¯ä¸ªæ–¹æ³•è¿›è¡Œé€ä¸ªåˆ†æã€ä¼˜åŒ–ï¼Œæ¯ä¸ªé˜¶æ®µéƒ½åšåˆ°æè‡´ã€‚</p><h2>è¯¾åä½œä¸š</h2><p>æŒ‰ç…§ä»Šå¤©æ–‡ä¸­æåˆ°çš„ Time Profiler å·¥å…·æ£€æŸ¥æ–¹æ³•è€—æ—¶çš„åŸç†ï¼Œä½ æ¥åŠ¨æ‰‹å®ç°ä¸€ä¸ªæ–¹æ³•è€—æ—¶æ£€æŸ¥å·¥å…·å§ã€‚</p><p>æ„Ÿè°¢ä½ çš„æ”¶å¬ï¼Œæ¬¢è¿ä½ åœ¨è¯„è®ºåŒºç»™æˆ‘ç•™è¨€åˆ†äº«ä½ çš„è§‚ç‚¹ï¼Œä¹Ÿæ¬¢è¿æŠŠå®ƒåˆ†äº«ç»™æ›´å¤šçš„æœ‹å‹ä¸€èµ·é˜…è¯»ã€‚</p><p><span class="reference">æœ€è¿‘ï¼Œæˆ‘æ”¶åˆ°ä¸€äº›åŒå­¦çš„åé¦ˆï¼Œè¯´è¿™é—¨è¯¾çš„ä¸€äº›å†…å®¹æ¯”è¾ƒæ·±ï¼Œä¸€æ—¶éš¾ä»¥ç¢ç£¨é€ã€‚å¦‚æœä½ ä¹Ÿæœ‰è¿™æ ·çš„æ„Ÿå—ï¼Œæ¨èä½ å­¦ä¹ æå®¢æ—¶é—´åˆšåˆšä¸Šæ–°çš„å¦ä¸€é—¨è§†é¢‘è¯¾ç¨‹ï¼šç”±è…¾è®¯é«˜çº§å·¥ç¨‹å¸ˆæœ±å¾·æƒï¼Œä¸»è®²çš„ã€Šä» 0 å¼€å‘ä¸€æ¬¾ iOS Appã€‹ã€‚</span></p><p><span class="reference">æœ±å¾·æƒè€å¸ˆå°†ä¼šåŸºäºæœ€æ–°æŠ€æœ¯ï¼Œä»å®è·µå‡ºå‘ï¼Œæ‰‹æŠŠæ‰‹å¸¦ä½ æ„å»ºç±»ä»Šæ—¥å¤´æ¡çš„Appã€‚è¦çŸ¥é“ï¼Œé‚£äº›å¾ˆç‰›çš„ iOS å¼€å‘è€…ï¼Œå¾€å¾€éƒ½å…·å¤‡ç‹¬ç«‹å¼€å‘ä¸€æ¬¾ App çš„èƒ½åŠ›ã€‚</span></p><p><span class="reference">è¿™é—¨è¯¾æ­£åœ¨ä¸Šæ–°ä¼˜æƒ ï¼Œæ¬¢è¿ç‚¹å‡»<a href="https://time.geekbang.org/course/intro/169?utm_term=zeusKHUZ0&amp;utm_source=app&amp;utm_medium=geektime&amp;utm_campaign=169-presell&amp;utm_content=daiming">è¿™é‡Œ</a>è¯•çœ‹ã€‚</span></p><p><img src="https://static001.geekbang.org/resource/image/f5/27/f5ee90aa0183a4bcc688980bd625eb27.jpg" alt=""></p><h2>ç²¾é€‰ç•™è¨€ï¼š</h2>
        <ul>
        
<li>
    <div>
        <div style="color: #888;font-size:15.25px;font-weight:400;line-height:1.2">
            å¥½å¤šä½™å…ˆç”Ÿä¸¶  2019-03-14 08:34:43
        </div>
        <div style="color:#353535;font-weight:400;white-space:normal;word-break:break-all;line-height:1.6">
            å®Œäº†ï¼Œä¸Šæ¥å°±æ‡µé€¼ [79èµ]
        </div>
        <br/>
<div>
    <div style="color:#888;font-size:15.25px;font-weight:400;line-height:1.2">ä½œè€…å›å¤2019-03-14 14:21:36</div>
    <div style="color:#353535;font-weight:400;white-space:normal;word-break:break-all;line-height:1.6">å¯ä»¥ä»ä½œä¸šå…¥æ‰‹ï¼Œå­¦ä¹ ä¸èƒ½ç€æ€¥ï¼Œéœ€è¦æ…¢æ…¢æ¥ï¼Œå¤šé‡å¤å°±ä¼šæœ‰æ›´å¤šä½“ä¼š</div>
</div>
            
    </div>
</li>
            
<br/>

<li>
    <div>
        <div style="color: #888;font-size:15.25px;font-weight:400;line-height:1.2">
            å½­åºçŒ¿  2019-03-14 01:16:01
        </div>
        <div style="color:#353535;font-weight:400;white-space:normal;word-break:break-all;line-height:1.6">
            ä¸€æ¥å°±ç‹ç‚¸ğŸ˜³ [76èµ]
        </div>
        
    </div>
</li>
            
<br/>

<li>
    <div>
        <div style="color: #888;font-size:15.25px;font-weight:400;line-height:1.2">
            ä¸€ç¼•é’äº‘ä¸  2019-03-14 09:51:59
        </div>
        <div style="color:#353535;font-weight:400;white-space:normal;word-break:break-all;line-height:1.6">
            å­¦åˆ°äº†ï¼Œå¯åŠ¨æ—¶é—´æçš„å¤ªçŸ­ï¼Œé¢†å¯¼è¯´åŠ ä¸ªsleepï¼Œåˆ«äººéƒ½çœ‹ä¸åˆ°æˆ‘ä»¬çš„æ¬¢è¿é¡µäº† [69èµ]
        </div>
        
    </div>
</li>
            
<br/>

<li>
    <div>
        <div style="color: #888;font-size:15.25px;font-weight:400;line-height:1.2">
            åŸåŒ—å§œå…¬  2019-03-14 16:43:33
        </div>
        <div style="color:#353535;font-weight:400;white-space:normal;word-break:break-all;line-height:1.6">
            æˆ‘çš„æ‰‹æ˜¯å’‹å›äº‹ï¼Œçœ‹åˆ°æ±‡ç¼–å°±ç›´æ¥æ»‘ä¸‹æ¥çœ‹è¯„è®ºäº† [23èµ]
        </div>
        
    </div>
</li>
            
<br/>

<li>
    <div>
        <div style="color: #888;font-size:15.25px;font-weight:400;line-height:1.2">
            è¥¿äº¬å¯Œè´µå…”  2019-03-14 16:30:49
        </div>
        <div style="color:#353535;font-weight:400;white-space:normal;word-break:break-all;line-height:1.6">
            çœ‹å®Œè¿™ç¯‡æˆ‘è†¨èƒ€äº†ï¼Œæˆ‘éƒ½æ•¢å»ç‚¹ objc_msgSend æºç æ–‡ä»¶äº†ï¼Œå—¯ï¼Œä¸å‡ºæ„æ–™ï¼Œä¸€å¥æ²¡çœ‹æ‡‚ã€‚ã€‚ã€‚ [17èµ]
        </div>
        <br/>
<div>
    <div style="color:#888;font-size:15.25px;font-weight:400;line-height:1.2">ä½œè€…å›å¤2019-03-14 21:10:50</div>
    <div style="color:#353535;font-weight:400;white-space:normal;word-break:break-all;line-height:1.6">å“ˆå“ˆ</div>
</div>
            
    </div>
</li>
            
<br/>

<li>
    <div>
        <div style="color: #888;font-size:15.25px;font-weight:400;line-height:1.2">
            Neo  2019-03-14 01:05:19
        </div>
        <div style="color:#353535;font-weight:400;white-space:normal;word-break:break-all;line-height:1.6">
            ä¸é”™  æçº²æŒˆé¢†  å¸Œæœ›æ±‡ç¼–é‚£å—èƒ½ç¨å¾®ç»†è®²ä¸€ä¸‹  æ²¡æœ‰å¤ªå¤šå†™æ±‡ç¼–çš„ç»éªŒ [16èµ]
        </div>
        <br/>
<div>
    <div style="color:#888;font-size:15.25px;font-weight:400;line-height:1.2">ä½œè€…å›å¤2019-03-14 13:09:14</div>
    <div style="color:#353535;font-weight:400;white-space:normal;word-break:break-all;line-height:1.6">æ±‡ç¼–è¯­è¨€å…¥é—¨å¯ä»¥çœ‹é˜®ä¸€å³°è€å¸ˆçš„ã€Šæ±‡ç¼–è¯­è¨€å…¥é—¨æ•™ç¨‹ã€‹å•Šã€‚é“¾æ¥æ˜¯ http:&#47;&#47;www.ruanyifeng.com&#47;blog&#47;2018&#47;01&#47;assembly-language-primer.html ã€‚ä»¥åå¯ä»¥è€ƒè™‘å†™ä¸ª iOS è§†è§’çš„</div>
</div>
            
    </div>
</li>
            
<br/>

<li>
    <div>
        <div style="color: #888;font-size:15.25px;font-weight:400;line-height:1.2">
            æ˜Ÿç©º  2019-03-14 11:28:04
        </div>
        <div style="color:#353535;font-weight:400;white-space:normal;word-break:break-all;line-height:1.6">
            å‹æƒ…æç¤ºï¼šæƒ³è¦å°è¯•SMCallTraceçš„æœ‹å‹ï¼Œéœ€è¦åœ¨SMCallTrace.mä¸­æ‰“å¼€ç¬¬54è¡Œçš„æ³¨é‡Šã€‚ [13èµ]
        </div>
        <br/>
<div>
    <div style="color:#888;font-size:15.25px;font-weight:400;line-height:1.2">ä½œè€…å›å¤2019-03-14 20:41:39</div>
    <div style="color:#353535;font-weight:400;white-space:normal;word-break:break-all;line-height:1.6">èµ</div>
</div>
            
    </div>
</li>
            
<br/>

<li>
    <div>
        <div style="color: #888;font-size:15.25px;font-weight:400;line-height:1.2">
            å“ˆ  2019-03-14 07:15:35
        </div>
        <div style="color:#353535;font-weight:400;white-space:normal;word-break:break-all;line-height:1.6">
            è¯´swiftæ²¡æœ‰mainå‡½æ•°é‚£ä½ï¼Œå…¶å®swiftæ˜¯æœ‰mainå‡½æ•°çš„ï¼Œåªä¸è¿‡è‹¹æœæŠŠå®ƒç²¾ç®€æˆäº†ä¸€ä¸ª@NSApplicationMainäº†è€Œå·²ï¼Œä¸ä¿¡å»ä½ çš„AppDelegate.swiftæœ€ä¸Šé¢çœ‹ï¼ [12èµ]
        </div>
        <br/>
<div>
    <div style="color:#888;font-size:15.25px;font-weight:400;line-height:1.2">ä½œè€…å›å¤2019-03-14 13:36:35</div>
    <div style="color:#353535;font-weight:400;white-space:normal;word-break:break-all;line-height:1.6">èµ</div>
</div>
            
    </div>
</li>
            
<br/>

<li>
    <div>
        <div style="color: #888;font-size:15.25px;font-weight:400;line-height:1.2">
            æ¬§é”¦æ»”  2019-03-14 02:12:52
        </div>
        <div style="color:#353535;font-weight:400;white-space:normal;word-break:break-all;line-height:1.6">
            è¿™ä¸ªæ–¹æ³•è€—æ—¶è®¡ç®—çš„å·¥å…·å¾ˆèµï¼Œç™½å¤©è¦èŠ±ç‚¹æ—¶é—´å®è·µä¸€ä¸‹æ‰è¡Œã€‚<br><br>æœ‰ä¸ªè®©æˆ‘ç–‘æƒ‘çš„åœ°æ–¹æ˜¯å…³äºâ€œçƒ­å¯åŠ¨â€çš„æ¦‚å¿µï¼Œæˆ‘å†å»çœ‹äº†ä¸‹ WWDC ä¸Šçš„è¯´æ³•ï¼Œé‡Œé¢æåˆ°çƒ­å¯åŠ¨åº”è¯¥ä¹ŸåŒ…æ‹¬â€œå¯åŠ¨åé€€å‡º App å†å¯åŠ¨â€è¿™ç§æƒ…å†µï¼Œä¸çŸ¥é“æˆ‘ä¸‹é¢è¿™æ®µè¯çš„ç†è§£æ˜¯å¦æ­£ç¡®ï¼š<br><br>â€œAnd a warm launch is an app where the application is already in memory, either because it&#39;s been launched and quit previously, and it&#39;s still sitting in the discache in the kernel, or because you just copied it over.â€<br>- https:&#47;&#47;developer.apple.com&#47;videos&#47;play&#47;wwdc2016-406&#47;?time=1484<br><br> [10èµ]
        </div>
        <br/>
<div>
    <div style="color:#888;font-size:15.25px;font-weight:400;line-height:1.2">ä½œè€…å›å¤2019-03-14 13:23:46</div>
    <div style="color:#353535;font-weight:400;white-space:normal;word-break:break-all;line-height:1.6">å®˜æ–¹çš„è§£é‡Šå¾ˆå…¨é¢ï¼Œæƒ…å†µéƒ½è¯´æ¸…æ¥šäº†</div>
</div>
            
    </div>
</li>
            
<br/>

<li>
    <div>
        <div style="color: #888;font-size:15.25px;font-weight:400;line-height:1.2">
            Calabash_Boy  2019-03-16 13:59:18
        </div>
        <div style="color:#353535;font-weight:400;white-space:normal;word-break:break-all;line-height:1.6">
            æ‰ç–å­¦æµ…,ä¸€ä¸Šæ¥å°±è¦é‡æ–°å†çœ‹Hook,dylb,å¯„å­˜å™¨ä¸æ±‡ç¼–çš„ç›¸å…³çŸ¥è¯†,æˆ´é“­è€å¸ˆçš„èµ·ç‚¹å¾ˆé«˜,æœ‰äº›è·Ÿä¸ä¸Š,åªèƒ½è‡ªå·±æ…¢æ…¢è¡¥äº†.<br>å¦‚æœæœ‰çš„å°ä¼™ä¼´è·Ÿæˆ‘ä¸€æ ·æ„Ÿè§‰æœ‰éš¾åº¦,å¯ä»¥å…ˆçœ‹è¿™ç¯‡æ–‡ç« http:&#47;&#47;www.zoomfeng.com&#47;blog&#47;launch-time.htmläº†è§£ä¸‹åŸºç¡€æ¦‚å¿µ. [8èµ]
        </div>
        
    </div>
</li>
            
<br/>

<li>
    <div>
        <div style="color: #888;font-size:15.25px;font-weight:400;line-height:1.2">
            ä¸€ä»£çœŸé¾™  2019-03-14 12:57:54
        </div>
        <div style="color:#353535;font-weight:400;white-space:normal;word-break:break-all;line-height:1.6">
            ä½ åœ¨å¾€ä¸Šçœ‹å‡ å±‚ï¼Œæ‰€æœ‰çš„ocæ–¹æ³•éƒ½æ˜¯é€šè¿‡msg_sendä½œä¸ºç»Ÿä¸€å…¥å£ï¼Œä½ æ‰€è°“çš„å‡½æ•°æŒ‡é’ˆåœ¨è°ƒç”¨IMPåœ¨msg_sendåé¢æ­¥éª¤ã€‚ä½œä¸ºç¨‹åºå‘˜æ²¡çœ‹æ‡‚å†…å®¹å°±å‡ºæ¥å”§å”§æ­ªæ­ªï¼Œè¿™æ ·è·¯èµ°ä¸é•¿ã€‚ [8èµ]
        </div>
        
    </div>
</li>
            
<br/>

<li>
    <div>
        <div style="color: #888;font-size:15.25px;font-weight:400;line-height:1.2">
            Justin  2019-03-15 00:07:47
        </div>
        <div style="color:#353535;font-weight:400;white-space:normal;word-break:break-all;line-height:1.6">
            æˆ´è€å¸ˆï¼šå¤šä¸ªåŠ¨æ€åº“è¿›è¡Œåˆå¹¶ï¼Œå…·ä½“æ€ä¹ˆåˆå¹¶äº†ï¼Œæ²¡å¼„è¿‡åŠ¨æ€åº“åˆå¹¶è¯¥åŠŸèƒ½ [7èµ]
        </div>
        <br/>
<div>
    <div style="color:#888;font-size:15.25px;font-weight:400;line-height:1.2">ä½œè€…å›å¤2019-03-15 12:33:08</div>
    <div style="color:#353535;font-weight:400;white-space:normal;word-break:break-all;line-height:1.6">https:&#47;&#47;blog.automatic.com&#47;how-we-cut-our-ios-apps-launch-time-in-half-with-this-one-cool-trick-7aca2011e2ea äº†è§£ä¸‹</div>
</div>
            
    </div>
</li>
            
<br/>

<li>
    <div>
        <div style="color: #888;font-size:15.25px;font-weight:400;line-height:1.2">
            Sean Ma  2019-03-14 11:56:28
        </div>
        <div style="color:#353535;font-weight:400;white-space:normal;word-break:break-all;line-height:1.6">
            ä¸Šæ¥å°±æ±‡ç¼–ï¼Œè¥å…»è·Ÿä¸ä¸Šã€‚æƒ³é—®ä¸ªé—®é¢˜ï¼Œæ–‡ä¸­æåˆ°é¦–å±æ¸²æŸ“æ¸²æŸ“åæŒ‡çš„æ˜¯â€œè¿™ä¸ªé˜¶æ®µå°±æ˜¯ä»æ¸²æŸ“å®Œæˆæ—¶å¼€å§‹ï¼Œåˆ°didFinishLaunchingWithOptionsæ–¹æ³•åŸŸç»“æŸè€Œç»“æŸâ€ï¼Œæˆ‘è‡ªå·±è·‘demoçš„æ—¶å€™ï¼Œçœ‹åˆ°é¦–é¡µviewcontrollerå®ŒæˆåŠ è½½æ¸²æŸ“å‡ºæ¥èƒ½çœ‹åˆ°éƒ½è¦ç­‰åˆ°didFinishLaunchingWithOptions return trueï¼Œæ‰€ä»¥æˆ‘è¿™é‡Œå¯¹é¦–å±æ¸²æŸ“åçš„ç•Œå®šæœ‰ç–‘æƒ‘ [7èµ]
        </div>
        <br/>
<div>
    <div style="color:#888;font-size:15.25px;font-weight:400;line-height:1.2">ä½œè€…å›å¤2019-03-14 20:44:55</div>
    <div style="color:#353535;font-weight:400;white-space:normal;word-break:break-all;line-height:1.6">ä½ è¯´çš„å’ŒåŸæ–‡æ˜¯ä¸€ä¸ªæ„æ€</div>
</div>
            
    </div>
</li>
            
<br/>

<li>
    <div>
        <div style="color: #888;font-size:15.25px;font-weight:400;line-height:1.2">
            Master  2019-03-15 14:11:47
        </div>
        <div style="color:#353535;font-weight:400;white-space:normal;word-break:break-all;line-height:1.6">
            çœ‹å®Œæ–‡ç« ï¼Œå†çœ‹ä½œä¸šï¼Œæ„Ÿè§‰å°±æ˜¯è€å¸ˆå‘Šè¯‰æˆ‘ä»¬ 1 + 1 = 2ï¼Œç„¶åè®©æˆ‘ä»¬æ±‚å¤ªé˜³çš„è´¨é‡ã€‚ [6èµ]
        </div>
        
    </div>
</li>
            
<br/>

<li>
    <div>
        <div style="color: #888;font-size:15.25px;font-weight:400;line-height:1.2">
            å­¦æ— æ­¢å¢ƒ  2019-03-14 11:38:57
        </div>
        <div style="color:#353535;font-weight:400;white-space:normal;word-break:break-all;line-height:1.6">
            ä¸€ä¸Šæ¥å°±è¿™ä¹ˆå¹²ï¼Œæœ‰ç‚¹éš¾å¸æ”¶å•Šã€‚<br>æ²¡ä¸ªå‡ å¹´çš„iOSæ·±å…¥å­¦ä¹ çš„è¯ï¼Œè¿™è¯¾è¿˜çœŸçš„ä¸å¥½æ‡‚ã€‚<br>èƒ½åœ¨æ–‡ç« ä¸­å¤šæä¾›ç‚¹èµ„æ–™ä¹ˆæˆ–è€…å†è®²çš„ç»†ç‚¹ã€‚<br>ç¬é—´æ„Ÿè§‰è‡ªå·±æ˜¯ä¸ªæ¸£æ¸£ [6èµ]
        </div>
        <br/>
<div>
    <div style="color:#888;font-size:15.25px;font-weight:400;line-height:1.2">ä½œè€…å›å¤2019-03-14 20:44:03</div>
    <div style="color:#353535;font-weight:400;white-space:normal;word-break:break-all;line-height:1.6">å¯ä»¥å¤šçœ‹å‡ éï¼Œç•™è¨€é‡Œä¹Ÿæœ‰ç›¸å…³èµ„æ–™å“¦</div>
</div>
            
    </div>
</li>
            
<br/>

<li>
    <div>
        <div style="color: #888;font-size:15.25px;font-weight:400;line-height:1.2">
            å”¯å¥¹å‘½  2019-03-14 10:21:35
        </div>
        <div style="color:#353535;font-weight:400;white-space:normal;word-break:break-all;line-height:1.6">
            hook äº† objc_msgSend æ–¹æ³•ï¼Œå°±å¯ä»¥ hook  ocå…¨éƒ¨æ–¹æ³•ï¼Œè¿™å¥è¯æˆ‘ä¸èµæˆï¼Œçœ‹objcæºç ï¼Œä½ ä¼šå‘ç°æœ‰çš„ocæ–¹æ³•ç›´æ¥é€šè¿‡å‡½æ•°æŒ‡é’ˆè°ƒç”¨çš„,è¿™æ—¶å€™hook äº† objc_msgSend æ–¹æ³•ï¼Œæ˜¯æ²¡æœ‰ç”¨çš„ [6èµ]
        </div>
        <br/>
<div>
    <div style="color:#888;font-size:15.25px;font-weight:400;line-height:1.2">ä½œè€…å›å¤2019-03-14 20:33:04</div>
    <div style="color:#353535;font-weight:400;white-space:normal;word-break:break-all;line-height:1.6">å‡½æ•°æŒ‡é’ˆè°ƒç”¨å¯ä»¥ç”¨ ffi_call</div>
</div>
            
    </div>
</li>
            
<br/>

<li>
    <div>
        <div style="color: #888;font-size:15.25px;font-weight:400;line-height:1.2">
            Keå“€  2019-03-14 14:39:24
        </div>
        <div style="color:#353535;font-weight:400;white-space:normal;word-break:break-all;line-height:1.6">
            ä»Šå¤©çœ‹åˆ°å¤§ä½¬çš„è¯¾ç¨‹ï¼Œå‘ç°è¯´çš„hook objc_msgSendçš„æ±‡ç¼–éƒ¨åˆ†ï¼Œä½†æ˜¯å‘ç°åœ¨æ•™ç¨‹ä¸­çš„éƒ¨åˆ†å’Œä¹‹å‰å¤§ç¥17å¹´åšå®¢éƒ¨åˆ†æ˜¯ä¸€æ ·çš„ï¼Œéƒ½æ˜¯InspectiveC&#47;InspectiveCarm64.mmçš„æ±‡ç¼–ä»£ç ã€‚ç„¶åè·‘å»å¤§ç¥çš„githubæ‰¾åˆ°å¼€æºé¡¹ç›®å·²é˜…ï¼Œæ‹¿å‡ºé‡Œè¾¹hook objc_msgSendçš„æ±‡ç¼–å®ç°ï¼Œç„¶åæœ‰äº›éƒ¨åˆ†ä¸å¤ªç†è§£ã€‚å¸Œæœ›å¤§ç¥å¯ä»¥è§£ç­”ä¸€ä¸‹ï¼ˆè¿™äº›æ˜¯å·²é˜…é‡Œè¾¹æ‹¿å‡ºæ¥çš„æ±‡ç¼–ï¼‰<br>1.ä¸ºä»€ä¹ˆè¿™é‡Œè¦æŠŠlrç§»åˆ°x2ï¼Œx4ç§»åˆ°x3å‘¢ï¼Ÿ<br>__asm volatile (&quot;mov x2, lr\n&quot;);<br>__asm volatile (&quot;mov x3, x4\n&quot;);<br>2.ä¸ºä»€ä¹ˆè¦åœ¨è°ƒç”¨before_objc_msgSendï¼Œorig_objc_msgSendï¼Œafter_objc_msgSendæ–¹æ³•å‰åæŠŠx8ï¼Œx9çš„å€¼å­˜å…¥æ ˆä¸­å‘¢ï¼Ÿ<br>__asm volatile (&quot;stp x8, x9, [sp, #-16]!\n&quot;);<br>__asm volatile (&quot;mov x12, %0\n&quot; :: &quot;r&quot;(&amp;before_objc_msgSend));<br>__asm volatile (&quot;ldp x8, x9, [sp], #16\n&quot;);<br>3.ä¸ºä»€ä¹ˆåœ¨ä¸‰ä¸ªæ–¹æ³•æ‰§è¡Œå®Œä¹‹åå‘¢ï¼Œæœ€åx0ä¼šå­˜å‚¨æœ€åçš„å‡½æ•°è¿”å›åœ°å€å‘¢ï¼Ÿæˆ‘æ‰“æ–­ç‚¹çœ‹åˆ°æ¯æ¬¡éƒ½æ˜¯è¿™æ ·çš„ï¼Œä¸å¤ªç†è§£ï¼Œç„¶åæŠŠx0ï¼Œç§»åˆ°lrç¡®å®æ˜¯ä¸ºäº†æ‰§è¡Œä¹‹å‰objc_msgSendæ‰§è¡Œåä¸‹ä¸€æ¡æ‰§è¡Œçš„ä»£ç æ®µæ®µåœ°å€ã€‚<br>__asm volatile (&quot;mov lr, x0\n&quot;); [4èµ]
        </div>
        <br/>
<div>
    <div style="color:#888;font-size:15.25px;font-weight:400;line-height:1.2">ä½œè€…å›å¤2019-03-14 20:49:01</div>
    <div style="color:#353535;font-weight:400;white-space:normal;word-break:break-all;line-height:1.6">æ±‡ç¼–å»ºè®®å…ˆçœ‹ä¸‹ arm64 ç›¸å…³èµ„æ–™<br>https:&#47;&#47;blog.nelhage.com&#47;2010&#47;10&#47;amd64-and-va_arg&#47;<br>http:&#47;&#47;infocenter.arm.com&#47;help&#47;topic&#47;com.arm.doc.ihi0055b&#47;IHI0055B_aapcs64.pdf<br>https:&#47;&#47;developer.apple.com&#47;library&#47;ios&#47;documentation&#47;Xcode&#47;Conceptual&#47;iPhoneOSABIReference&#47;Articles&#47;ARM64FunctionCallingConventions.html<br><br>ç„¶åå•ƒå•ƒ objc_msgSend æºç </div>
</div>
            
    </div>
</li>
            
<br/>

<li>
    <div>
        <div style="color: #888;font-size:15.25px;font-weight:400;line-height:1.2">
            âœ¨å˜¿oå¤§è¿œ  2019-03-14 10:53:58
        </div>
        <div style="color:#353535;font-weight:400;white-space:normal;word-break:break-all;line-height:1.6">
            å¬çš„æ¯”è¾ƒè´¹åŠ›,æ„Ÿè§‰è¦ç”¨å¾ˆå¤šæ—¶é—´æ¥ç ”ç©¶äº†,åŠ æ²¹ [4èµ]
        </div>
        <br/>
<div>
    <div style="color:#888;font-size:15.25px;font-weight:400;line-height:1.2">ä½œè€…å›å¤2019-03-14 20:35:19</div>
    <div style="color:#353535;font-weight:400;white-space:normal;word-break:break-all;line-height:1.6">åŠ æ²¹ï¼Œç»†æ°´é•¿æµ</div>
</div>
            
    </div>
</li>
            
<br/>

<li>
    <div>
        <div style="color: #888;font-size:15.25px;font-weight:400;line-height:1.2">
            wchen  2019-03-14 10:05:32
        </div>
        <div style="color:#353535;font-weight:400;white-space:normal;word-break:break-all;line-height:1.6">
            çœ‹å®Œæ„Ÿè§‰è€å¸ˆæ‚¨è®²çš„æˆ‘å¥½åƒèƒ½å¬æ‡‚ï¼Œå®é™…è¦ä¸Šæ‰‹åˆæ‡µäº†ã€‚ã€‚ã€‚æ„Ÿè§‰è‡ªå·±å¥½åƒæ²¡æœ‰æŠ“ä½ç‚¹å®è´¨æ€§çš„ä¸œè¥¿ [4èµ]
        </div>
        <br/>
<div>
    <div style="color:#888;font-size:15.25px;font-weight:400;line-height:1.2">ä½œè€…å›å¤2019-03-14 20:29:15</div>
    <div style="color:#353535;font-weight:400;white-space:normal;word-break:break-all;line-height:1.6">æ‰€ä»¥è¯´å®è·µæ˜¯æœ€å¥½çš„è€å¸ˆ</div>
</div>
            
    </div>
</li>
            
<br/>

<li>
    <div>
        <div style="color: #888;font-size:15.25px;font-weight:400;line-height:1.2">
            Glennâ€¢D  2019-03-15 16:57:39
        </div>
        <div style="color:#353535;font-weight:400;white-space:normal;word-break:break-all;line-height:1.6">
            æ¨¡æ‹Ÿå™¨ä¸Šè¯•äº†ä¸€ä¸‹è€—æ—¶æ£€æŸ¥æ²¡æœ‰æ•ˆæœ [1èµ]
        </div>
        <br/>
<div>
    <div style="color:#888;font-size:15.25px;font-weight:400;line-height:1.2">ä½œè€…å›å¤2019-03-15 18:52:19</div>
    <div style="color:#353535;font-weight:400;white-space:normal;word-break:break-all;line-height:1.6">éœ€è¦çœŸæœºï¼Œarm64èŠ¯ç‰‡ï¼Œæ¨¡æ‹Ÿå™¨æ˜¯ x86</div>
</div>
            
    </div>
</li>
            </ul>
</div>
</body>
</html>