<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title>15-æ—¥å¿—ç›‘æ§ï¼šæ€æ ·è·å–Appä¸­çš„å…¨é‡æ—¥å¿—ï¼Ÿ</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
        <style>
        html {
            color: #333;
            -webkit-text-size-adjust: 100%;
            -ms-text-size-adjust: 100%;
            text-rendering: optimizelegibility;
            font-family: Helvetica Neue, PingFang SC, Verdana, Microsoft Yahei, Hiragino Sans GB, Microsoft Sans Serif, WenQuanYi Micro Hei, sans-serif
        }

        html.borderbox *,
        html.borderbox :after,
        html.borderbox :before {
            box-sizing: border-box
        }

        article,
        aside,
        blockquote,
        body,
        button,
        code,
        dd,
        details,
        dl,
        dt,
        fieldset,
        figcaption,
        figure,
        footer,
        form,
        h1,
        h2,
        h3,
        h4,
        h5,
        h6,
        header,
        hr,
        input,
        legend,
        li,
        menu,
        nav,
        ol,
        p,
        pre,
        section,
        td,
        textarea,
        th,
        ul {
            margin: 0;
            padding: 0
        }

        article,
        aside,
        details,
        figcaption,
        figure,
        footer,
        header,
        menu,
        nav,
        section {
            display: block
        }

        audio,
        canvas,
        video {
            display: inline-block
        }

        body,
        button,
        input,
        select,
        textarea {
            font: 300 1em/1.8 PingFang SC, Lantinghei SC, Microsoft Yahei, Hiragino Sans GB, Microsoft Sans Serif, WenQuanYi Micro Hei, Helvetica, sans-serif
        }

        button::-moz-focus-inner,
        input::-moz-focus-inner {
            padding: 0;
            border: 0
        }

        table {
            border-collapse: collapse;
            border-spacing: 0
        }

        fieldset,
        img {
            border: 0
        }

        blockquote {
            position: relative;
            color: #999;
            font-weight: 400;
            border-left: 1px solid #1abc9c;
            padding-left: 1em;
            margin: 1em 3em 1em 2em
        }

        @media only screen and (max-width: 640px) {
            blockquote {
                margin: 1em 0
            }
        }

        abbr,
        acronym {
            border-bottom: 1px dotted;
            font-variant: normal
        }

        abbr {
            cursor: help
        }

        del {
            text-decoration: line-through
        }

        address,
        caption,
        cite,
        code,
        dfn,
        em,
        th,
        var {
            font-style: normal;
            font-weight: 400
        }

        ol,
        ul {
            list-style: none
        }

        caption,
        th {
            text-align: left
        }

        q:after,
        q:before {
            content: ""
        }

        sub,
        sup {
            font-size: 75%;
            line-height: 0;
            position: relative
        }

        :root sub,
        :root sup {
            vertical-align: baseline
        }

        sup {
            top: -.5em
        }

        sub {
            bottom: -.25em
        }

        a {
            color: #1abc9c
        }

        a:hover {
            text-decoration: underline
        }

        .typo a {
            border-bottom: 1px solid #1abc9c
        }

        .typo a:hover {
            border-bottom-color: #555;
            color: #555
        }

        .typo a:hover,
        a,
        ins {
            text-decoration: none
        }

        .typo-u,
        u {
            text-decoration: underline
        }

        mark {
            background: #fffdd1;
            border-bottom: 1px solid #ffedce;
            padding: 2px;
            margin: 0 5px
        }

        code,
        pre,
        pre tt {
            font-family: Courier, Courier New, monospace
        }

        pre {
            background: hsla(0, 0%, 97%, .7);
            border: 1px solid #ddd;
            padding: 1em 1.5em;
            display: block;
            -webkit-overflow-scrolling: touch
        }

        hr {
            border: none;
            border-bottom: 1px solid #cfcfcf;
            margin-bottom: .8em;
            height: 10px
        }

        .typo-small,
        figcaption,
        small {
            font-size: .9em;
            color: #888
        }

        b,
        strong {
            font-weight: 700;
            color: #000
        }

        [draggable] {
            cursor: move
        }

        .clearfix:after,
        .clearfix:before {
            content: "";
            display: table
        }

        .clearfix:after {
            clear: both
        }

        .clearfix {
            zoom: 1
        }

        .textwrap,
        .textwrap td,
        .textwrap th {
            word-wrap: break-word;
            word-break: break-all
        }

        .textwrap-table {
            table-layout: fixed
        }

        .serif {
            font-family: Palatino, Optima, Georgia, serif
        }

        .typo-dl,
        .typo-form,
        .typo-hr,
        .typo-ol,
        .typo-p,
        .typo-pre,
        .typo-table,
        .typo-ul,
        .typo dl,
        .typo form,
        .typo hr,
        .typo ol,
        .typo p,
        .typo pre,
        .typo table,
        .typo ul,
        blockquote {
            margin-bottom: 1rem
        }

        h1,
        h2,
        h3,
        h4,
        h5,
        h6 {
            font-family: PingFang SC, Helvetica Neue, Verdana, Microsoft Yahei, Hiragino Sans GB, Microsoft Sans Serif, WenQuanYi Micro Hei, sans-serif;
            color: #000;
            line-height: 1.35
        }

        .typo-h1,
        .typo-h2,
        .typo-h3,
        .typo-h4,
        .typo-h5,
        .typo-h6,
        .typo h1,
        .typo h2,
        .typo h3,
        .typo h4,
        .typo h5,
        .typo h6 {
            margin-top: 1.2em;
            margin-bottom: .6em;
            line-height: 1.35
        }

        .typo-h1,
        .typo h1 {
            font-size: 2em
        }

        .typo-h2,
        .typo h2 {
            font-size: 1.8em
        }

        .typo-h3,
        .typo h3 {
            font-size: 1.6em
        }

        .typo-h4,
        .typo h4 {
            font-size: 1.4em
        }

        .typo-h5,
        .typo-h6,
        .typo h5,
        .typo h6 {
            font-size: 1.2em
        }

        .typo-ul,
        .typo ul {
            margin-left: 1.3em;
            list-style: disc
        }

        .typo-ol,
        .typo ol {
            list-style: decimal;
            margin-left: 1.9em
        }

        .typo-ol ol,
        .typo-ol ul,
        .typo-ul ol,
        .typo-ul ul,
        .typo li ol,
        .typo li ul {
            margin-bottom: .8em;
            margin-left: 2em
        }

        .typo-ol ul,
        .typo-ul ul,
        .typo li ul {
            list-style: circle
        }

        .typo-table td,
        .typo-table th,
        .typo table caption,
        .typo table td,
        .typo table th {
            border: 1px solid #ddd;
            padding: .5em 1em;
            color: #666
        }

        .typo-table th,
        .typo table th {
            background: #fbfbfb
        }

        .typo-table thead th,
        .typo table thead th {
            background: hsla(0, 0%, 95%, .7)
        }

        .typo table caption {
            border-bottom: none
        }

        .typo-input,
        .typo-textarea {
            -webkit-appearance: none;
            border-radius: 0
        }

        .typo-em,
        .typo em,
        caption,
        legend {
            color: #000;
            font-weight: inherit
        }

        .typo-em {
            position: relative
        }

        .typo-em:after {
            position: absolute;
            top: .65em;
            left: 0;
            width: 100%;
            overflow: hidden;
            white-space: nowrap;
            content: "\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB"
        }

        .typo img {
            max-width: 100%
        }

        .common-content {
            font-weight: 400;
            color: #353535;
            line-height: 1.75rem;
            white-space: normal;
            word-break: normal;
            font-size: 1rem
        }

        .common-content img {
            display: block;
            max-width: 100%;
            background-color: #eee
        }

        .common-content audio,
        .common-content video {
            width: 100%;
            background-color: #eee
        }

        .common-content center,
        .common-content font {
            margin-top: 1rem;
            display: inline-block
        }

        .common-content center {
            width: 100%
        }

        .common-content pre {
            margin-top: 1rem;
            padding-left: 0;
            padding-right: 0;
            position: relative;
            overflow: hidden
        }

        .common-content pre code {
            font-size: .8rem;
            font-family: Consolas, Liberation Mono, Menlo, monospace, Courier;
            display: block;
            width: 100%;
            box-sizing: border-box;
            padding-left: 1rem;
            padding-right: 1rem;
            overflow-x: auto
        }

        .common-content hr {
            border: none;
            margin-top: 1.5rem;
            margin-bottom: 1.5rem;
            border-top: 1px solid #f5f5f5;
            height: 1px;
            background: none
        }

        .common-content b,
        .common-content h1,
        .common-content h2,
        .common-content h3,
        .common-content h4,
        .common-content h5,
        .common-content strong {
            font-weight: 700
        }

        .common-content h1,
        .common-content h2 {
            font-size: 1.125rem;
            margin-bottom: .45rem
        }

        .common-content h3,
        .common-content h4,
        .common-content h5 {
            font-size: 1rem;
            margin-bottom: .45rem
        }

        .common-content p {
            font-weight: 400;
            color: #353535;
            margin-top: .15rem
        }

        .common-content .orange {
            color: #ff5a05
        }

        .common-content .reference {
            font-size: 1rem;
            color: #888
        }

        .custom-rich-content h1 {
            margin-top: 0;
            font-weight: 400;
            font-size: 15.25px;
            border-bottom: 1px solid #eee;
            line-height: 2.8
        }

        .custom-rich-content li,
        .custom-rich-content p {
            font-size: 14px;
            color: #888;
            line-height: 1.6
        }

        table.hljs-ln {
            margin-bottom: 0;
            border-spacing: 0;
            border-collapse: collapse
        }

        table.hljs-ln,
        table.hljs-ln tbody,
        table.hljs-ln td,
        table.hljs-ln tr {
            box-sizing: border-box
        }

        table.hljs-ln td {
            padding: 0;
            border: 0
        }

        table.hljs-ln td.hljs-ln-numbers {
            min-width: 15px;
            color: rgba(27, 31, 35, .3);
            text-align: right;
            white-space: nowrap;
            cursor: pointer;
            user-select: none
        }

        table.hljs-ln td.hljs-ln-code,
        table.hljs-ln td.hljs-ln-numbers {
            font-family: SFMono-Regular, Consolas, Liberation Mono, Menlo, Courier, monospace;
            font-size: 12px;
            line-height: 20px;
            vertical-align: top
        }

        table.hljs-ln td.hljs-ln-code {
            position: relative;
            padding-right: 10px;
            padding-left: 10px;
            overflow: visible;
            color: #24292e;
            word-wrap: normal;
            white-space: pre
        }

        video::-webkit-media-controls {
            overflow: hidden !important
        }

        video::-webkit-media-controls-enclosure {
            width: calc(100% + 32px);
            margin-left: auto
        }

        ._29HP61GA_0 {
            max-width:800px;
            margin:0 auto;
            margin-bottom: 20px;
            font-weight: 400;
            color: #353535;
            line-height: 1.76;
            white-space: normal;
            word-break: normal;
            font-size: 17px;
            -webkit-transition: background-color .3s ease;
            transition: background-color .3s ease
        }

        ._29HP61GA_0 .MathJax_Display {
            overflow: auto
        }

        ._29HP61GA_0 .poster {
            position: fixed;
            left: -10000px;
            top: -10000px;
            overflow: hidden;
            padding: 1rem;
            background: #ececec
        }

        ._29HP61GA_0 .richcontent-pre-copy {
            font-size: 13px;
            color: #888;
            position: absolute;
            right: 1em;
            top: .5em;
            cursor: pointer;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none
        }

        ._29HP61GA_0 .richcontent-pre-copy .iconfont {
            font-size: 12px;
            margin-right: .2em
        }

        ._29HP61GA_0 a {
            color: #fa8919;
            border-bottom: 1px solid #fa8919
        }

        ._29HP61GA_0 img {
            display: block;
            max-width: 100%;
            position: relative;
            left: 50%;
            -webkit-transform: translateX(-50%);
            transform: translateX(-50%);
            background-color: #eee;
            vertical-align: top;
            border-radius: 0
        }

        ._29HP61GA_0 audio,
        ._29HP61GA_0 video {
            width: 100%;
            background-color: #eee
        }

        ._29HP61GA_0 pre {
            margin-top: 16px;
            padding: 34px 0 0;
            margin-bottom: 30px;
            position: relative;
            border-radius: 6px;
            background: rgba(246, 247, 251, .749);
            border: 0
        }

        ._29HP61GA_0 pre code {
            font-size: 12px;
            font-family: Consolas, Liberation Mono, Menlo, monospace, Courier;
            display: block;
            -webkit-box-sizing: border-box;
            box-sizing: border-box;
            margin-left: 16px;
            margin-right: 16px;
            overflow-x: scroll
        }

        ._29HP61GA_0 pre code:after {
            content: "";
            height: 30px;
            width: 100%;
            display: block
        }

        ._29HP61GA_0 hr {
            border: none;
            margin-top: 1.5rem;
            margin-bottom: 1.5rem;
            border-top: 1px solid #f5f5f5;
            height: 1px;
            background: none
        }

        ._29HP61GA_0 h1,
        ._29HP61GA_0 h2,
        ._29HP61GA_0 h3,
        ._29HP61GA_0 h4,
        ._29HP61GA_0 h5 {
            margin-bottom: 20px;
            margin-top: 0;
            font-weight: 700
        }

        ._29HP61GA_0 b,
        ._29HP61GA_0 strong {
            font-weight: 700
        }

        ._29HP61GA_0 h1 {
            font-size: 21px
        }

        ._29HP61GA_0 h2 {
            font-size: 20px
        }

        ._29HP61GA_0 h3 {
            font-size: 19px
        }

        ._29HP61GA_0 h4 {
            font-size: 18px
        }

        ._29HP61GA_0 h5 {
            font-size: 17px
        }

        ._29HP61GA_0 center,
        ._29HP61GA_0 p {
            font-weight: 400;
            color: #353535;
            margin-top: 0;
            margin-bottom: 30px;
            word-break: break-word
        }

        ._29HP61GA_0 center {
            text-align: center
        }

        ._29HP61GA_0 blockquote {
            margin-top: 0;
            margin-bottom: 34px;
            border-left: 3px solid #e8e8e8;
            padding-left: 17px;
            color: #353535
        }

        ._29HP61GA_0 blockquote p {
            margin-top: 0;
            margin-bottom: 0
        }

        ._29HP61GA_0 ol,
        ._29HP61GA_0 ul {
            margin-bottom: 30px
        }

        ._29HP61GA_0 ol p,
        ._29HP61GA_0 ul p {
            margin-top: 0;
            margin-bottom: 0
        }

        ._29HP61GA_0 ol {
            list-style: decimal;
            margin-left: 20px
        }

        ._29HP61GA_0 ul li {
            padding-left: 17px;
            position: relative;
            margin-bottom: 10px
        }

        ._29HP61GA_0 ul li:after {
            content: "";
            height: 6px;
            width: 6px;
            border-radius: 50%;
            background: #353535;
            position: absolute;
            top: 10px;
            left: 0
        }

        ._29HP61GA_0 .orange {
            color: #fa8919
        }

        ._29HP61GA_0 .reference {
            color: #888
        }

        ._29HP61GA_0 .m-right {
            text-align: right
        }

        ._29HP61GA_0 .m-center {
            text-align: center;
            display: block
        }

        ._29HP61GA_0 .m-gray {
            color: #888
        }

        ._29HP61GA_0 .m-small {
            font-size: 15px
        }

        ._29HP61GA_0 table.hljs-ln {
            margin-bottom: 0;
            border-spacing: 0;
            border-collapse: collapse
        }

        ._29HP61GA_0 table.hljs-ln,
        ._29HP61GA_0 table.hljs-ln tbody,
        ._29HP61GA_0 table.hljs-ln td,
        ._29HP61GA_0 table.hljs-ln tr {
            -webkit-box-sizing: border-box;
            box-sizing: border-box
        }

        ._29HP61GA_0 table.hljs-ln td {
            padding: 0;
            border: 0
        }

        ._29HP61GA_0 table.hljs-ln td.hljs-ln-numbers {
            min-width: 15px;
            font-size: 12px;
            color: rgba(27, 31, 35, .3);
            text-align: right;
            white-space: nowrap;
            cursor: pointer;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none
        }

        ._29HP61GA_0 table.hljs-ln td.hljs-ln-code,
        ._29HP61GA_0 table.hljs-ln td.hljs-ln-numbers {
            font-family: SFMono-Regular, Consolas, Liberation Mono, Menlo, Courier, monospace;
            line-height: 20px;
            vertical-align: top
        }

        ._29HP61GA_0 table.hljs-ln td.hljs-ln-code {
            position: relative;
            padding-right: 10px;
            padding-left: 10px;
            overflow: visible;
            font-size: 13px;
            color: #666;
            word-wrap: normal;
            white-space: pre
        }

    </style>
</head>
<body>
<div class="_29HP61GA_0">
<h1>15-æ—¥å¿—ç›‘æ§ï¼šæ€æ ·è·å–Appä¸­çš„å…¨é‡æ—¥å¿—ï¼Ÿ</h1>
<p>ä½ å¥½ï¼Œæˆ‘æ˜¯æˆ´é“­ã€‚</p><p>æˆ‘åœ¨å‰é¢çš„ç¬¬12ã€13å’Œ14ä¸‰ç¯‡æ–‡ç« ä¸­ï¼Œå’Œä½ åˆ†äº«äº†å´©æºƒã€å¡é¡¿ã€å†…å­˜é—®é¢˜çš„ç›‘æ§ã€‚ä¸€æ—¦ç›‘æ§åˆ°é—®é¢˜ï¼Œæˆ‘ä»¬è¿˜éœ€è¦è®°å½•ä¸‹é—®é¢˜çš„è¯¦ç»†ä¿¡æ¯ï¼Œå½¢æˆæ—¥å¿—å‘ŠçŸ¥å¼€å‘è€…ï¼Œè¿™æ ·å¼€å‘è€…æ‰èƒ½å¤Ÿä»è¿™äº›æ—¥å¿—ä¸­å®šä½é—®é¢˜ã€‚</p><p>ä½†æ˜¯ï¼Œå¾ˆå¤šé—®é¢˜çš„å®šä½ä»…é é—®é¢˜å‘ç”Ÿçš„é‚£ä¸€åˆ¹é‚£è®°å½•çš„ä¿¡æ¯æ˜¯ä¸å¤Ÿçš„ï¼Œæˆ‘ä»¬è¿˜éœ€è¦ä¾èµ–æ›´å¤šçš„æ—¥å¿—ä¿¡æ¯ã€‚</p><p>åœ¨ä»¥å‰å…¬å¸è¿˜æ²¡æœ‰å…¨é‡æ—¥å¿—çš„æ—¶å€™ï¼Œæˆ‘å‘ç°çº¿ä¸Šæœ‰ä¸€ä¸ªä¸ŠæŠ¥åˆ°æœåŠ¡å™¨çš„ç”±æ•°æ®è§£æå‡ºé”™è€Œå¼•èµ·å´©æºƒçš„é—®é¢˜ã€‚ç”±äºæ•°æ®è§£ææ˜¯åœ¨ç”Ÿæˆæ•°æ®ååœ¨å¦ä¸€ä¸ªçº¿ç¨‹å»¶è¿Ÿæ‰§è¡Œçš„ï¼Œæ‰€ä»¥å¾ˆéš¾å®šä½åˆ°æ˜¯è°ç”Ÿæˆçš„æ•°æ®é€ æˆäº†å´©æºƒã€‚</p><p>å¦‚æœè¿™ä¸ªæ—¶å€™ï¼Œæˆ‘èƒ½å¤ŸæŸ¥çœ‹åˆ°å´©æºƒå‰çš„æ‰€æœ‰æ—¥å¿—ï¼ŒåŒ…æ‹¬æ‰‹åŠ¨æ‰“çš„æ—¥å¿—å’Œæ— ä¾µå…¥è‡ªåŠ¨åŸ‹ç‚¹çš„æ—¥å¿—ï¼Œå°±èƒ½å¤Ÿå¿«é€Ÿå®šä½åˆ°æ˜¯ç”±è°ç”Ÿæˆçš„æ•°æ®é€ æˆäº†å´©æºƒã€‚è¿™äº›åœ¨ App é‡Œè®°å½•çš„æ‰€æœ‰æ—¥å¿—ï¼Œæ¯”å¦‚ç”¨äºè®°å½•ç”¨æˆ·è¡Œä¸ºå’Œå…³é”®æ“ä½œçš„æ—¥å¿—ï¼Œå°±æ˜¯å…¨é‡æ—¥å¿—äº†ã€‚</p><p>æœ‰äº†æ›´å¤šçš„ä¿¡æ¯ï¼Œæ‰æ›´åˆ©äºå¼€å‘è€…å»å¿«é€Ÿã€ç²¾å‡†åœ°å®šä½å„ç§å¤æ‚é—®é¢˜ï¼Œå¹¶æé«˜è§£å†³é—®é¢˜çš„æ•ˆç‡ã€‚é‚£ä¹ˆï¼Œ<strong>æ€æ ·æ‰èƒ½å¤Ÿè·å–åˆ° App é‡Œæ›´å¤šçš„æ—¥å¿—å‘¢</strong>ï¼Ÿ</p><p>ä½ å¯èƒ½ä¼šè§‰å¾—è·å–åˆ°å…¨é‡çš„æ—¥å¿—å¾ˆå®¹æ˜“å•Šï¼Œåªè¦æ‰€æœ‰æ•°æ®éƒ½é€šè¿‡ç›¸åŒçš„æ‰“æ—¥å¿—åº“ï¼Œä¸å°±å¯ä»¥æ”¶é›†åˆ°æ‰€æœ‰æ—¥å¿—äº†å—ï¼Ÿä½†ï¼Œç°å®æƒ…å†µå¹¶æ²¡æœ‰è¿™ä¹ˆç®€å•ã€‚</p><p>ä¸€ä¸ª App å¾ˆæœ‰å¯èƒ½æ˜¯ç”±å¤šä¸ªå›¢é˜Ÿå…±åŒå¼€å‘ç»´æŠ¤çš„ï¼Œä¸åŒå›¢é˜Ÿä½¿ç”¨çš„æ—¥å¿—åº“ç”±äºå†å²åŸå› å¯èƒ½éƒ½ä¸ä¸€æ ·ï¼Œè¦ä¹ˆæ˜¯è‡ªå·±å¼€å‘çš„ï¼Œè¦ä¹ˆå°±æ˜¯ä½¿ç”¨äº†ä¸åŒç¬¬ä¸‰æ–¹æ—¥å¿—åº“ã€‚å¦‚æœæˆ‘ä»¬åªæ˜¯ä¸ºäº†ç»Ÿä¸€è·å–æ—¥å¿—ï¼Œè€Œå»æ¨åŠ¨å…¶ä»–å›¢é˜Ÿå°†ä»¥å‰çš„æ—¥å¿—åº“ä»£ç å…¨éƒ¨æ›¿æ¢æ‰ï¼Œæ˜æ˜¾æ˜¯ä¸ç°å®çš„ã€‚å› ä¸ºï¼Œæˆ‘ä»¬è°ä¹Ÿæ— æ³•ç¡®å®šï¼Œè¿™ç§æ›¿æ¢æ—¥å¿—åº“çš„å·¥ä½œï¼Œä»¥åæ˜¯ä¸æ˜¯è¿˜ä¼šå†æ¥ä¸€æ¬¡ã€‚</p><!-- [[[read_end]]] --><p>é‚£ä¹ˆï¼Œæˆ‘ä»¬è¿˜æœ‰ä»€ä¹ˆå¥½åŠæ³•æ¥è§£å†³è¿™ä¸ªé—®é¢˜å—ï¼Ÿåœ¨æˆ‘çœ‹æ¥ï¼Œè¦è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å°±éœ€è¦å…ˆé€ä¸ªåœ°åˆ†æå„å›¢é˜Ÿä½¿ç”¨çš„æ—¥å¿—åº“ï¼Œä½¿ç”¨ä¸ä¾µå…¥çš„æ–¹å¼å»è·å–æ‰€æœ‰æ—¥å¿—ã€‚</p><p>æ¥ä¸‹æ¥ï¼Œæˆ‘å°±å…ˆå’Œä½ è¯´è¯´æ€æ ·è·å–ç³»ç»Ÿè‡ªå¸¦NSLogçš„æ—¥å¿—ã€‚</p><h2>è·å– NSLog çš„æ—¥å¿—</h2><p>æˆ‘ä»¬éƒ½çŸ¥é“ï¼ŒNSLogå…¶å®å°±æ˜¯ä¸€ä¸ªCå‡½æ•°ï¼Œå‡½æ•°å£°æ˜æ˜¯ï¼š</p><pre><code>void NSLog(NSString *format, ...);
</code></pre><p>å®ƒçš„ä½œç”¨æ˜¯ï¼Œè¾“å‡ºä¿¡æ¯åˆ°æ ‡å‡†çš„Erroræ§åˆ¶å°å’Œç³»ç»Ÿæ—¥å¿—ï¼ˆsyslogï¼‰ä¸­ã€‚åœ¨å†…éƒ¨å®ç°ä¸Šï¼Œå®ƒå…¶å®ä½¿ç”¨çš„æ˜¯ASLï¼ˆApple System Loggerï¼Œæ˜¯è‹¹æœå…¬å¸è‡ªå·±å®ç°çš„ä¸€å¥—è¾“å‡ºæ—¥å¿—çš„æ¥å£ï¼‰çš„APIï¼Œå°†æ—¥å¿—æ¶ˆæ¯ç›´æ¥å­˜å‚¨åœ¨ç£ç›˜ä¸Šã€‚</p><p>é‚£ä¹ˆï¼Œ<strong>æˆ‘ä»¬å¦‚ä½•æ‰èƒ½è·å–åˆ°é€šè¿‡ASLå­˜æ”¾åœ¨ç³»ç»Ÿæ—¥å¿—ä¸­çš„æ—¥å¿—å‘¢ï¼Ÿ</strong></p><p>ASL ä¼šæä¾›æ¥å£å»æŸ¥æ‰¾æ‰€æœ‰çš„æ—¥å¿—ï¼Œé€šè¿‡ <a href="https://github.com/CocoaLumberjack/CocoaLumberjack">CocoaLumberjack</a> è¿™ä¸ªç¬¬ä¸‰æ–¹æ—¥å¿—åº“é‡Œçš„ DDASLLogCapture è¿™ä¸ªç±»ï¼Œæˆ‘ä»¬å¯ä»¥æ‰¾åˆ°å®æ—¶æ•è· NSLog çš„æ–¹æ³•ã€‚DDASLLogCaptureä¼šåœ¨ start æ–¹æ³•é‡Œå¼€å¯ä¸€ä¸ªå¼‚æ­¥å…¨å±€é˜Ÿåˆ—å»æ•è· ASL å­˜å‚¨çš„æ—¥å¿—ã€‚start æ–¹æ³•çš„ä»£ç å¦‚ä¸‹ï¼š</p><pre><code>+ (void)start {
    ...
    dispatch_async(dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0), ^(void) {
        [self captureAslLogs];
    });
}
</code></pre><p>å¯ä»¥çœ‹å‡ºï¼Œæ•è·ASLå­˜å‚¨æ—¥å¿—çš„ä¸»è¦å¤„ç†éƒ½åœ¨ captureAslLogs æ–¹æ³•é‡Œã€‚åœ¨æ—¥å¿—è¢«ä¿å­˜åˆ° ASL çš„æ•°æ®åº“æ—¶ï¼Œsyslogdï¼ˆç³»ç»Ÿé‡Œç”¨äºæ¥æ”¶åˆ†å‘æ—¥å¿—æ¶ˆæ¯çš„æ—¥å¿—å®ˆæŠ¤è¿›ç¨‹ï¼‰ ä¼šå‘å‡ºä¸€æ¡é€šçŸ¥ã€‚å› ä¸ºå‘è¿‡æ¥çš„è¿™ä¸€æ¡é€šçŸ¥å¯èƒ½ä¼šæœ‰å¤šæ¡æ—¥å¿—ï¼Œæ‰€ä»¥è¿˜éœ€è¦å…ˆåšäº›åˆå¹¶çš„å·¥ä½œï¼Œå°†å¤šæ¡æ—¥å¿—è¿›è¡Œåˆå¹¶ã€‚å…·ä½“çš„å®ç°ï¼Œä½ å¯ä»¥æŸ¥çœ‹ captureAslLogs æ–¹æ³•çš„å®ç°ï¼Œå…³é”®ä»£ç å¦‚ä¸‹ï¼š</p><pre><code>+ (void)captureAslLogs {
    @autoreleasepool {
        ...
        notify_register_dispatch(kNotifyASLDBUpdate, &amp;notifyToken, dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_HIGH, 0),^(int token) {
            @autoreleasepool {
                ...
                // åˆ©ç”¨è¿›ç¨‹æ ‡è¯†å…¼å®¹åœ¨æ¨¡æ‹Ÿå™¨æƒ…å†µæ—¶å…¶ä»–è¿›ç¨‹æ—¥å¿—æ— æ•ˆé€šçŸ¥
                [self configureAslQuery:query];

                // è¿­ä»£å¤„ç†æ‰€æœ‰æ–°æ—¥å¿—
                aslmsg msg;
                aslresponse response = asl_search(NULL, query);

                while ((msg = asl_next(response))) {
                    // è®°å½•æ—¥å¿—
                    [self aslMessageReceived:msg];

                    lastSeenID = (unsigned long long)atoll(asl_get(msg, ASL_KEY_MSG_ID));
                }
                asl_release(response);
                asl_free(query);

                if (_cancel) {
                    notify_cancel(token);
                    return;
                }
            }
        });
</code></pre><p>åœ¨ä¸Šé¢è¿™æ®µä»£ç ä¸­ï¼Œnotify_register_dispatchçš„ä½œç”¨æ˜¯ç”¨æ¥æ³¨å†Œè¿›ç¨‹é—´çš„ç³»ç»Ÿé€šçŸ¥ã€‚å…¶ä¸­ï¼ŒkNotifyASLDBUpdate å®è¡¨ç¤ºçš„å°±æ˜¯ï¼Œæ—¥å¿—è¢«ä¿å­˜åˆ° ASL æ•°æ®åº“æ—¶å‘å‡ºçš„è·¨è¿›ç¨‹é€šçŸ¥ï¼Œå…¶é”®å€¼æ˜¯ com.apple.system.logger.messageã€‚</p><p>æ—¢ç„¶æ˜¯è·¨è¿›ç¨‹é€šçŸ¥ï¼Œé‚£ä¹ˆå¤šä¸ª App ä¹‹é—´ä¹Ÿæ˜¯å¯ä»¥è¿›è¡Œé€šçŸ¥çš„ã€‚ä¸è¿‡å¯¹äº iPhone æ¥è¯´ï¼Œå¤šä¸ª App åŒæ—¶ä¿æ´»çš„æœºä¼šå¤ªå°‘ï¼Œæ‰€ä»¥ä¸€èˆ¬éƒ½æ˜¯æ¥æ”¶ç³»ç»ŸåŠŸèƒ½å‘å‡ºçš„é€šçŸ¥ã€‚</p><p>åœ¨iOSç³»ç»Ÿä¸­ï¼Œç±»ä¼¼åœ°æŠŠæ—¥å¿—ä¿å­˜åˆ° ASL æ•°æ®åº“æ—¶å‘å‡ºçš„é€šçŸ¥è¿˜æœ‰å¾ˆå¤šç§ï¼Œæ¯”å¦‚é”®å€¼æ˜¯ com.apple.system.lowdiskspace çš„ kNotifyVFSLowDiskSpace å®ï¼Œè¯¥é€šçŸ¥æ˜¯åœ¨ç³»ç»Ÿç£ç›˜ç©ºé—´ä¸è¶³æ—¶å‘å‡ºçš„ã€‚å½“æ•è·åˆ°è¿™ä¸ªé€šçŸ¥æ—¶ï¼Œä½ å¯ä»¥å»æ¸…ç†ç¼“å­˜ç©ºé—´ï¼Œé¿å…å‘ç”Ÿç¼“å­˜å†™å…¥ç£ç›˜å¤±è´¥çš„æƒ…å†µã€‚</p><p>æ›´å¤šçš„è·¨è¿›ç¨‹é€šçŸ¥å®ï¼Œä½ å¯ä»¥åœ¨ notify_keys.h é‡Œçœ‹åˆ°ï¼Œç»ˆç«¯æŸ¥çœ‹å‘½ä»¤å¦‚ä¸‹ï¼š</p><pre><code>cat /usr/include/notify_keys.h
</code></pre><p>æ¥ä¸‹æ¥ï¼Œ<strong>æˆ‘ç»§ç»­å’Œä½ è¯´è¯´ captureAslLogsæ–¹æ³•ï¼Œçœ‹çœ‹ captureAslLogs æ˜¯æ€ä¹ˆå¤„ç† ASL æ—¥å¿—çš„ã€‚</strong></p><p>åœ¨captureAslLogsæ–¹æ³•é‡Œï¼Œå¤„ç†æ—¥å¿—çš„æ–¹æ³•æ˜¯ aslMessageReceivedï¼Œå…¥å‚æ˜¯ aslmsg ç±»å‹ï¼Œç”±äº aslmsg ç±»å‹ä¸æ˜¯å­—ç¬¦ä¸²ç±»å‹ï¼Œæ— æ³•ç›´æ¥æŸ¥çœ‹ã€‚æ‰€ä»¥åœ¨ aslMessageReceivedæ–¹æ³•çš„å¼€å§‹é˜¶æ®µï¼Œä¼šä½¿ç”¨ asl_get æ–¹æ³•å°†å…¶è½¬æ¢ä¸º char å­—ç¬¦ä¸²ç±»å‹ã€‚ç±»å‹è½¬æ¢ä»£ç å¦‚ä¸‹ï¼š</p><pre><code>const char* messageCString = asl_get( msg, ASL_KEY_MSG );
</code></pre><p>æ¥ä¸‹æ¥ï¼Œchar å­—ç¬¦ä¸²ä¼šè¢«è½¬æ¢æˆ NSStringç±»å‹ï¼ŒNSString æ˜¯ Objective-C é‡Œå­—ç¬¦ä¸²ç±»å‹ï¼Œè½¬æˆ NSString æ›´å®¹æ˜“åœ¨ Objective-C é‡Œä½¿ç”¨ã€‚</p><pre><code>NSString *message = @(messageCString);
</code></pre><p>å› ä¸ºCocoaLumberjack çš„æ—¥å¿—æœ€åéƒ½æ˜¯é€šè¿‡ DDLog:log:message: æ–¹æ³•è¿›è¡Œè®°å½•çš„ï¼Œå…¶ä¸­ message å‚æ•°çš„ç±»å‹æ˜¯ DDLogMessageï¼Œæ‰€ä»¥ NSStringç±»å‹è¿˜éœ€è¦è½¬æ¢æˆ DDLogMessage ç±»å‹ã€‚</p><p>å› ä¸º DDLogMessage ç±»å‹åŒ…å«äº†æ—¥å¿—çº§åˆ«ï¼Œæ‰€ä»¥è½¬æ¢ç±»å‹åè¿˜éœ€è¦è®¾ç½®æ—¥å¿—çš„çº§åˆ«ã€‚CocoaLumberjack è¿™ä¸ªç¬¬ä¸‰æ–¹æ—¥å¿—åº“ï¼Œå°†æ•è·åˆ°çš„ NSLog æ—¥å¿—çš„çº§åˆ«è®¾ç½®ä¸ºäº† Verboseã€‚é‚£ä¸ºä»€ä¹ˆè¦è¿™ä¹ˆè®¾ç½®å‘¢ï¼Ÿ</p><p>CocoaLumberjack çš„æ—¥å¿—çº§åˆ«ï¼ŒåŒ…æ‹¬ä¸¤ç±»ï¼š</p><ul>
<li>ç¬¬ä¸€ç±»æ˜¯Verbose å’Œ Debug ï¼Œå±äºè°ƒè¯•çº§ï¼›</li>
<li>ç¬¬äºŒç±»æ˜¯Infoã€Warnã€Error ï¼Œå±äºæ­£å¼çº§ï¼Œé€‚ç”¨äºè®°å½•æ›´é‡è¦çš„ä¿¡æ¯ï¼Œæ˜¯éœ€è¦æŒä¹…åŒ–å­˜å‚¨çš„ã€‚ç‰¹åˆ«æ˜¯ï¼ŒErrorå¯ä»¥ç†è§£ä¸ºä¸¥é‡çº§åˆ«æœ€é«˜ã€‚</li>
</ul><p>å°†æ—¥å¿—çº§åˆ«å®šä¹‰ä¸º Verboseï¼Œä¹Ÿåªæ˜¯åŸºäºCocoaLumberjack å¯¹ NSLogæ—¥å¿—çš„ç†è§£ã€‚å…¶å®ï¼ŒNSLogæ˜¯è¢«è‹¹æœå…¬å¸ä¸“é—¨å®šä¹‰ä¸ºè®°å½•é”™è¯¯ä¿¡æ¯çš„ï¼š</p><blockquote>
<p>Logs an error message to the Apple System Log facility.</p>
</blockquote><p>æ®æˆ‘è§‚å¯Ÿï¼Œç°åœ¨æœ‰å¾ˆå¤šå¼€å‘è€…éƒ½ç”¨ NSLog æ¥è°ƒè¯•ã€‚<strong>ä½†æ˜¯æˆ‘è§‰å¾—ï¼Œä¸€èˆ¬çš„ç¨‹åºè°ƒè¯•ï¼Œç”¨æ–­ç‚¹å°±å¥½äº†ï¼Œæˆ‘ä¸æ¨èä½ æŠŠ NSLog ä½œä¸ºä¸€ç§è°ƒè¯•æ‰‹æ®µã€‚</strong>å› ä¸ºï¼Œä½¿ç”¨NSLogè°ƒè¯•ï¼Œä¼šå‘ç”Ÿ IO ç£ç›˜æ“ä½œï¼Œå½“é¢‘ç¹ä½¿ç”¨ NSLog æ—¶ï¼Œæ€§èƒ½å°±ä¼šå˜å¾—ä¸å¥½ã€‚å¦å¤–ï¼Œå„å›¢é˜Ÿéƒ½ä½¿ç”¨ NSLog æ¥è°ƒè¯•çš„è¯å¾ˆå®¹æ˜“å°±ä¼šåˆ·å±ï¼Œè¿™æ ·ä½ ä¹Ÿæ²¡æœ‰åŠæ³•åœ¨æ§åˆ¶å°ä¸Šå¿«é€Ÿã€å‡†ç¡®åœ°æ‰¾åˆ°ä½ è‡ªå·±çš„è°ƒè¯•ä¿¡æ¯ã€‚</p><p>è€Œå¦‚æœä½ éœ€è¦æ±‡æ€»ä¸€æ®µæ—¶é—´çš„è°ƒè¯•æ—¥å¿—çš„è¯ï¼Œè‡ªå·±æŠŠè¿™äº›æ—¥å¿—å†™åˆ°ä¸€ä¸ªæ–‡ä»¶é‡Œå°±å¥½äº†ã€‚è¿™æ ·çš„è¯ï¼Œä½ éšä¾¿æƒ³è¦æ€ä¹ˆçœ‹éƒ½è¡Œï¼Œä¹Ÿä¸ä¼šå‚æ‚å…¶ä»–äººæ‰“çš„æ—¥å¿—ã€‚</p><p>æ‰€ä»¥è¯´ ï¼ŒCocoaLumberjack å°† NSLog è®¾ç½®ä¸º Verbose ï¼Œåœ¨æˆ‘çœ‹æ¥ CocoaLumberjack å¯¹ NSLog çš„ç†è§£ä¹Ÿä¸å¤Ÿå‡†ç¡®ã€‚è¯´å®Œå¦‚ä½•åˆ›å»ºä¸€ä¸ª DDLogMessageï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å†çœ‹çœ‹<strong>å¦‚ä½•é€šè¿‡ DDLog ä½¿ç”¨ DDLogMessage ä½œä¸ºå‚æ•°æ·»åŠ ä¸€æ¡ ASL æ—¥å¿—</strong>ã€‚ä¸‹é¢æ˜¯ DDLog è®°å½• ASL æ—¥å¿—ç›¸å…³çš„ä»£ç ï¼š</p><pre><code>DDLogMessage *logMessage = [[DDLogMessage alloc] initWithMessage:message level:_captureLevel flag:flag context:0 file:@&quot;DDASLLogCapture&quot; function:nil line:0 tag:nil option:0 timestamp:timeStamp];

[DDLog log:async message:logMessage]
</code></pre><p>åˆ°è¿™é‡Œï¼Œé€šè¿‡ASLè·å– NSLog æ—¥å¿—çš„è¿‡ç¨‹ä½ å°±åº”è¯¥å¾ˆæ¸…æ¥šäº†ã€‚ä½ å¯ä»¥ç›´æ¥ä½¿ç”¨ CocoaLumberjack è¿™ä¸ªåº“é€šè¿‡ [DDASLLogCapture start] æ•è·æ‰€æœ‰ NSLog çš„æ—¥å¿—ã€‚</p><p>ä½ ç°åœ¨å·²ç»æ¸…æ¥šäº†CocoaLumberjack çš„æ•è·åŸç†å’Œæ–¹æ³•ï¼Œå¦‚æœä¸æƒ³å¼•å…¥è¿™ä¸ªç¬¬ä¸‰æ–¹åº“çš„è¯ï¼Œä¹Ÿå¯ä»¥æŒ‰ç…§å®ƒçš„æ€è·¯å†™ä¸ªç®€åŒ–ç‰ˆçš„å·¥å…·å‡ºæ¥ï¼Œåªè¦è¿™ä¸ªå·¥å…·èƒ½å¤ŸæŠŠæ—¥å¿—è®°å½•ä¸‹æ¥ï¼Œå¹¶ä¸”èƒ½å¤Ÿåœ¨å‡ºç°é—®é¢˜çš„æ—¶å€™ï¼ŒæŠŠæ—¥å¿—ä¸Šä¼ åˆ°æœåŠ¡å™¨ï¼Œæ–¹ä¾¿æˆ‘ä»¬è¿›è¡Œé—®é¢˜çš„è¿½è¸ªå’Œå®šä½å³å¯ã€‚</p><p>ä¸ºäº†ä½¿æ—¥å¿—æ›´é«˜æ•ˆï¼Œæ›´æœ‰ç»„ç»‡ï¼Œåœ¨ iOS 10 ä¹‹åï¼Œä½¿ç”¨äº†æ–°çš„ç»Ÿä¸€æ—¥å¿—ç³»ç»Ÿï¼ˆUnified Logging Systemï¼‰æ¥è®°å½•æ—¥å¿—ï¼Œå…¨é¢å–ä»£ ASLçš„æ–¹å¼ã€‚ä»¥ä¸‹æ˜¯å®˜æ–¹åŸè¯ï¼š</p><blockquote>
<p>Unified logging is available in iOS 10.0 and later, macOS 10.12 and later, tvOS 10.0 and later, and watchOS 3.0 and later, and supersedes ASL (Apple System Logger) and the Syslog APIs. Historically, log messages were written to specific locations on disk, such as /etc/system.log. The unified logging system stores messages in memory and in a data store, rather than writing to text-based log files.</p>
</blockquote><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°±çœ‹çœ‹iOS 10ä¹‹åï¼Œå¦‚ä½•æ¥è·å–NSLogæ—¥å¿—ã€‚</p><p>ç»Ÿä¸€æ—¥å¿—ç³»ç»Ÿçš„æ–¹å¼ï¼Œæ˜¯æŠŠæ—¥å¿—é›†ä¸­å­˜æ”¾åœ¨å†…å­˜å’Œæ•°æ®åº“é‡Œï¼Œå¹¶æä¾›å•ä¸€ã€é«˜æ•ˆå’Œé«˜æ€§èƒ½çš„æ¥å£å»è·å–ç³»ç»Ÿæ‰€æœ‰çº§åˆ«çš„æ¶ˆæ¯ä¼ é€’ã€‚</p><p>macOS 10.12 å¼€å§‹ä½¿ç”¨äº†ç»Ÿä¸€æ—¥å¿—ç³»ç»Ÿï¼Œæˆ‘ä»¬é€šè¿‡æ§åˆ¶å°åº”ç”¨ç¨‹åºæˆ–æ—¥å¿—å‘½ä»¤è¡Œå·¥å…·ï¼Œå°±å¯ä»¥æŸ¥çœ‹åˆ°æ—¥å¿—æ¶ˆæ¯ã€‚</p><p>ä½†æ˜¯ï¼Œæ–°çš„ç»Ÿä¸€æ—¥å¿—ç³»ç»Ÿæ²¡æœ‰ ASL é‚£æ ·çš„æ¥å£å¯ä»¥è®©æˆ‘ä»¬å–å‡ºå…¨éƒ¨æ—¥å¿—ï¼Œæ‰€ä»¥<strong>ä¸ºäº†å…¼å®¹æ–°çš„ç»Ÿä¸€æ—¥å¿—ç³»ç»Ÿï¼Œä½ å°±éœ€è¦å¯¹ NSLog æ—¥å¿—çš„è¾“å‡ºè¿›è¡Œé‡å®šå‘ã€‚</strong></p><p>å¯¹NSLogè¿›è¡Œé‡å®šå‘ï¼Œæˆ‘ä»¬é¦–å…ˆæƒ³åˆ°çš„å°±æ˜¯é‡‡ç”¨ Hook çš„æ–¹å¼ã€‚å› ä¸ºNSLogæœ¬èº«å°±æ˜¯ä¸€ä¸ªCå‡½æ•°ï¼Œè€Œä¸æ˜¯ Objective-Cæ–¹æ³•ï¼Œæ‰€ä»¥æˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨ fishhook æ¥å®Œæˆé‡å®šå‘çš„å·¥ä½œã€‚å…·ä½“çš„å®ç°ä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š</p><pre><code>static void (&amp;orig_nslog)(NSString *format, ...);

void redirect_nslog(NSString *format, ...) {
    // å¯ä»¥åœ¨è¿™é‡Œå…ˆè¿›è¡Œè‡ªå·±çš„å¤„ç†
    
    // ç»§ç»­æ‰§è¡ŒåŸ NSLog
    va_list va;
    va_start(va, format);
    NSLogv(format, va);
    va_end(va);
}

int main(int argc, const char * argv[]) {
    @autoreleasepool {
        struct rebinding nslog_rebinding = {&quot;NSLog&quot;,redirect_nslog,(void*)&amp;orig_nslog};

        NSLog(@&quot;try redirect nslog %@,%d&quot;,@&quot;is that ok?&quot;);
    }
    return
</code></pre><p>å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘åœ¨ä¸Šé¢è¿™æ®µä»£ç ä¸­ï¼Œåˆ©ç”¨äº† fishhook å¯¹æ–¹æ³•çš„ç¬¦å·åœ°å€è¿›è¡Œäº†é‡æ–°ç»‘å®šï¼Œä»è€Œåªè¦æ˜¯ NSLog çš„è°ƒç”¨å°±éƒ½ä¼šè½¬å‘ redirect_nslog æ–¹æ³•è°ƒç”¨ã€‚</p><p>åœ¨ redirect_nslog æ–¹æ³•ä¸­ï¼Œä½ å¯ä»¥å…ˆè¿›è¡Œè‡ªå·±çš„å¤„ç†ï¼Œæ¯”å¦‚å°†æ—¥å¿—çš„è¾“å‡ºé‡æ–°è¾“å‡ºåˆ°è‡ªå·±çš„æŒä¹…åŒ–å­˜å‚¨ç³»ç»Ÿé‡Œï¼Œæ¥ç€è°ƒç”¨ NSLog ä¹Ÿä¼šè°ƒç”¨çš„ NSLogv æ–¹æ³•è¿›è¡ŒåŸ NSLog æ–¹æ³•çš„è°ƒç”¨ã€‚å½“ç„¶äº†ï¼Œä½ ä¹Ÿå¯ä»¥ä½¿ç”¨ fishhook æä¾›çš„åŸæ–¹æ³•è°ƒç”¨æ–¹å¼ orig_nslogï¼Œè¿›è¡ŒåŸ NSLog æ–¹æ³•çš„è°ƒç”¨ã€‚ä¸Šé¢ä»£ç é‡Œä¹Ÿå·²ç»å£°æ˜äº†ç±» orig_nslogï¼Œç›´æ¥è°ƒç”¨å³å¯ã€‚</p><p>NSLog æœ€åå†™æ–‡ä»¶æ—¶çš„å¥æŸ„æ˜¯ STDERRï¼Œæˆ‘å…ˆå‰è·Ÿä½ è¯´äº†è‹¹æœå¯¹äº NSLog çš„å®šä¹‰æ˜¯è®°å½•é”™è¯¯çš„ä¿¡æ¯ï¼ŒSTDERR çš„å…¨ç§°æ˜¯ standard errorï¼Œç³»ç»Ÿé”™è¯¯æ—¥å¿—éƒ½ä¼šé€šè¿‡ STDERR å¥æŸ„æ¥è®°å½•ï¼Œæ‰€ä»¥ NSLog æœ€ç»ˆå°†é”™è¯¯æ—¥å¿—è¿›è¡Œå†™æ“ä½œçš„æ—¶å€™ä¹Ÿä¼šä½¿ç”¨ STDERR å¥æŸ„ï¼Œè€Œ dup2 å‡½æ•°æ˜¯ä¸“é—¨è¿›è¡Œæ–‡ä»¶é‡å®šå‘çš„ï¼Œé‚£ä¹ˆä¹Ÿå°±æœ‰äº†å¦ä¸€ä¸ªä¸ä½¿ç”¨ fishhook è¿˜å¯ä»¥æ•è· NSLog æ—¥å¿—çš„æ–¹æ³•ã€‚ä½ å¯ä»¥ä½¿ç”¨ dup2 é‡å®šå‘ STDERR å¥æŸ„ï¼Œä½¿å¾—é‡å®šå‘çš„ä½ç½®å¯ä»¥ç”±ä½ æ¥æ§åˆ¶ï¼Œå…³é”®ä»£ç å¦‚ä¸‹ï¼š</p><pre><code>int fd = open(path, (O_RDWR | O_CREAT), 0644);
dup2(fd, STDERR_FILENO);
</code></pre><p>å…¶ä¸­ï¼Œpath å°±æ˜¯ä½ è‡ªå®šä¹‰çš„é‡å®šå‘è¾“å‡ºçš„æ–‡ä»¶åœ°å€ã€‚</p><p>è¿™æ ·ï¼Œæˆ‘ä»¬å°±èƒ½å¤Ÿè·å–åˆ°å„ä¸ªç³»ç»Ÿç‰ˆæœ¬çš„ NSLogäº†ã€‚é‚£ä¹ˆï¼Œé€šè¿‡å…¶ä»–æ–¹å¼æ‰“çš„æ—¥å¿—ï¼Œæˆ‘ä»¬æ€ä¹ˆæ‰èƒ½è·å–åˆ°å‘¢ï¼Ÿ</p><p>ç°åœ¨ä¸æ—¥å¿—ç›¸å…³çš„ç¬¬ä¸‰æ–¹åº“é‡Œé¢ï¼Œä½¿ç”¨æœ€å¤šçš„å°±æ˜¯ CocoaLumberjackã€‚è€Œä¸”ï¼Œå…¶ä»–çš„å¾ˆå¤šç¬¬ä¸‰åº“çš„æ€è·¯ä¹Ÿå’ŒCocoaLumberjackç±»ä¼¼ï¼Œéƒ½æ˜¯ç›´æ¥åœ¨ CocoaLumberjack çš„åŸºç¡€ä¸ŠåŒ…è£…äº†ä¸€å±‚ï¼Œå¢åŠ äº†ç»Ÿä¸€ç®¡æ§åŠ›å’Œæ˜“ç”¨æ€§è€Œå·²ã€‚</p><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°±å…ˆçœ‹çœ‹ CocoaLumberjack çš„æ•´ä½“æ¶æ„æ˜¯æ€æ ·çš„ï¼Œè¿›è€Œæ‰¾åˆ°è·å– CocoaLumberjack æ‰€æœ‰æ—¥å¿—çš„æ–¹æ³•ã€‚</p><h2>è·å– CocoaLumberjack æ—¥å¿—</h2><p>CocoaLumberjackä¸»è¦ç”±DDLogã€DDLogerã€DDLogFormatterå’ŒDDLogMessageå››éƒ¨åˆ†ç»„æˆï¼Œå…¶æ•´ä½“æ¶æ„å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š<br>
<img src="https://static001.geekbang.org/resource/image/ff/fb/ff12f684d74be1b901e2dede5b5ab5fb.png" alt=""></p><p>åœ¨è¿™å…¶ä¸­ï¼ŒDDLog æ˜¯ä¸ªå…¨å±€çš„å•ä¾‹ç±»ï¼Œä¼šä¿å­˜ DDLogger åè®®çš„ loggerï¼›DDLogFormatter ç”¨æ¥æ ¼å¼åŒ–æ—¥å¿—çš„æ ¼å¼ï¼›DDLogMessage æ˜¯å¯¹æ—¥å¿—æ¶ˆæ¯çš„ä¸€ä¸ªå°è£…ï¼›DDLogger åè®®æ˜¯ç”± DDAbstractLogger å®ç°çš„ã€‚logger éƒ½æ˜¯ç»§æ‰¿äº DDAbstractLoggerï¼š</p><ul>
<li>æ—¥å¿—è¾“å‡ºåˆ°æ§åˆ¶å°æ˜¯é€šè¿‡ DDTTYLoggerå®ç°çš„ï¼›</li>
<li>DDASLLogger å°±æ˜¯ç”¨æ¥æ•è· NSLog è®°å½•åˆ° ASL æ•°æ®åº“çš„æ—¥å¿—ï¼›</li>
<li>DDAbstractDatabaseLoggeræ˜¯æ•°æ®åº“æ“ä½œçš„æŠ½è±¡æ¥å£ï¼›</li>
<li>DDFileLogger æ˜¯ç”¨æ¥ä¿å­˜æ—¥å¿—åˆ°æ–‡ä»¶çš„ï¼Œè¿˜æä¾›äº†è¿”å› CocoaLumberjack æ—¥å¿—ä¿å­˜æ–‡ä»¶è·¯å¾„çš„æ–¹æ³•ï¼Œä½¿ç”¨æ–¹æ³•å¦‚ä¸‹ï¼š</li>
</ul><pre><code>DDFileLogger *fileLogger = [[DDFileLogger alloc] init];
NSString *logDirectory = [fileLogger.logFileManager logsDirectory];
</code></pre><p>å…¶ä¸­ï¼ŒlogDirectory æ–¹æ³•å¯ä»¥è·å–æ—¥å¿—æ–‡ä»¶çš„ç›®å½•è·¯å¾„ã€‚æœ‰äº†ç›®å½•ä»¥åï¼Œæˆ‘ä»¬å°±å¯ä»¥è·å–åˆ°ç›®å½•ä¸‹æ‰€æœ‰çš„ CocoaLumberjack çš„æ—¥å¿—äº†ï¼Œä¹Ÿå°±è¾¾åˆ°äº†æˆ‘ä»¬è¦è·å–CocoaLumberjack æ‰€æœ‰æ—¥å¿—çš„ç›®çš„ã€‚</p><h2>å°ç»“</h2><p>åœ¨ä»Šå¤©è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘å’Œä½ ä»‹ç»äº† NSLog å’Œ CocoaLumberjack æ—¥å¿—çš„è·å–æ–¹æ³•ã€‚è¿™ä¸¤ç§æ‰“æ—¥å¿—çš„æ–¹å¼åŸºæœ¬è¦†ç›–äº†å¤§éƒ¨åˆ†åœºæ™¯ï¼Œä½ åœ¨ä½¿ç”¨å…¶ä»–æ—¥å¿—åº“æ—¶ï¼Œåªè¦æ‰¾åˆ°æ—¥å¿—å­˜å‚¨çš„ç›®å½•ï¼Œå°±å¯ä»¥è¿›è¡Œæ—¥å¿—çš„æ”¶é›†åˆå¹¶å·¥ä½œäº†ã€‚</p><p>æ”¶é›†å…¨é‡æ—¥å¿—ï¼Œå¯ä»¥æé«˜åˆ†æå’Œè§£å†³é—®é¢˜çš„æ•ˆç‡ï¼ŒèŠ‚çœä¸‹æ¥çš„æ—¶é—´æˆ‘ä»¬å¯ä»¥å»åšæ›´æœ‰æ„ä¹‰çš„äº‹æƒ…ã€‚</p><p>åœ¨ä»Šå¤©è®²è·å– NSLog æ—¥å¿—çš„è¿‡ç¨‹ä¸­ï¼Œä½ ä¼šå‘ç°ä¸ºäº†è¾¾åˆ°è·å– NSLog æ—¥å¿—çš„ç›®çš„ï¼Œæ–¹æ³•æœ‰ä¸‰ä¸ªï¼š</p><ul>
<li>ç¬¬ä¸€ä¸ªæ˜¯ä½¿ç”¨å®˜æ–¹æä¾›çš„æ¥å£ ASL æ¥è·å–ï¼›</li>
<li>ç¬¬äºŒä¸ªæ˜¯é€šè¿‡ä¸€æ‹›åƒéå¤©ä¸‹çš„ fishhook æ¥ hook çš„æ–¹æ³•ï¼›</li>
<li>ç¬¬ä¸‰ä¸ªæ–¹æ³•ï¼Œéœ€è¦ç”¨åˆ° dup2 å‡½æ•°å’Œ STDERR å¥æŸ„ã€‚æˆ‘ä»¬åªæœ‰äº†è§£äº†è¿™äº›çŸ¥è¯†ç‚¹åï¼Œæ‰ä¼šæƒ³åˆ°è¿™ä¸ªæ–¹æ³•ã€‚</li>
</ul><p>åœ¨ç¬¬2ç¯‡æ–‡ç« â€œ<a href="https://time.geekbang.org/column/article/85331">App å¯åŠ¨é€Ÿåº¦æ€ä¹ˆåšä¼˜åŒ–ä¸ç›‘æ§ï¼Ÿ</a>â€é‡Œï¼Œæˆ‘ä¹Ÿæåˆ°è¿‡ä¸¤ä¸ªæ–¹æ¡ˆæ¥å®ç°å¯åŠ¨ç›‘æ§ã€‚å…¶ä¸­ï¼Œç¬¬äºŒä¸ªä½¿ç”¨ hook objc_msgSend æ–¹æ³•çš„æ–¹æ¡ˆï¼Œçœ‹èµ·æ¥è¿æ±‡ç¼–è¯­è¨€éƒ½ç”¨åˆ°äº†ï¼Œåº”è¯¥æ²¡æœ‰æ›´å¥½çš„æ–¹æ¡ˆäº†å§ï¼Œå…¶å®ä¸ç„¶ï¼Œæˆ‘è¿™é‡Œå–ä¸ªå…³å­ï¼Œåé¢æœ‰æœºä¼šæˆ‘è¿˜ä¼šå’Œä½ ä»‹ç»å¦ä¸€ä¸ªæ–¹æ¡ˆã€‚</p><p>æ‰€ä»¥ï¼Œæˆ‘ä»¬æ¥è§¦çš„çŸ¥è¯†é¢è¶Šå¤šï¼Œé‡åˆ°é—®é¢˜æ—¶èƒ½æƒ³åˆ°çš„åŠæ³•ä¹Ÿå°±ä¼šè¶Šå¤šã€‚å½“å‡ºç°æ„å¤–æ—¶ï¼Œå°±åƒæ˜¯ ASL åœ¨ iOS 10.0 ä¹‹åä¸èƒ½ç”¨äº†è¿™ç§æƒ…å†µä¸‹ï¼Œä½ ä¾ç„¶è¿˜èƒ½å¤Ÿæœ‰å…¶ä»–æ–¹æ³•æ¥è§£å†³é—®é¢˜ã€‚</p><h2>è¯¾åä½œä¸š</h2><p>ä»Šå¤©è¯¾ç¨‹ä¸­æåˆ°äº†è·¨è¿›ç¨‹é€šçŸ¥ï¼Œé‚£ä¹ˆæ¥ä¸‹æ¥å°±è¯·ä½ å†™ä¸€ä¸ªç›‘å¬ç”¨æˆ·è®¾å¤‡ç£ç›˜ç©ºé—´ä¸å¤Ÿæ—¶ï¼Œæ¸…ç†App ç¼“å­˜æ–‡ä»¶çš„åŠŸèƒ½å§ã€‚</p><p>æˆ‘ä»Šå¤©è¿˜ä¼šå†å¤šå¸ƒç½®ä¸€ä¸ªä½œä¸šã€‚æˆ‘åœ¨å’Œä½ åˆ†ææ•è· NSLog æ—¥å¿—æ—¶ï¼Œæåˆ°äº†ä¸€ä¸ªç”¨dup2æ›¿æ¢æ‰é»˜è®¤å¥æŸ„çš„æ–¹æ³•ã€‚æ‰€ä»¥ï¼Œæˆ‘å¸Œæœ›ä½ å¯ä»¥åŠ¨æ‰‹å®è·µä¸€ä¸‹ï¼ŒæŒ‰ç…§è¿™ä¸ªæ€è·¯å°†å…¶å®Œæ•´å®ç°å‡ºæ¥å§ã€‚</p><p>æ„Ÿè°¢ä½ çš„æ”¶å¬ï¼Œæ¬¢è¿ä½ åœ¨è¯„è®ºåŒºç»™æˆ‘ç•™è¨€åˆ†äº«ä½ çš„è§‚ç‚¹ï¼Œä¹Ÿæ¬¢è¿æŠŠå®ƒåˆ†äº«ç»™æ›´å¤šçš„æœ‹å‹ä¸€èµ·é˜…è¯»ã€‚</p><p><img src="https://static001.geekbang.org/resource/image/0d/3f/0da0c6fee64a3103893dd3f8b2b58e3f.jpg" alt=""></p><h2>ç²¾é€‰ç•™è¨€ï¼š</h2>
        <ul>
        
<li>
    <div>
        <div style="color: #888;font-size:15.25px;font-weight:400;line-height:1.2">
            Geek_97bcf5  2019-04-13 14:51:38
        </div>
        <div style="color:#353535;font-weight:400;white-space:normal;word-break:break-all;line-height:1.6">
            ä¸€èˆ¬å¤§å‚çš„appéƒ½ä¸ä¼šç”¨NSLogæ¥æ‰“å°æ—¥å¿—çš„ï¼Œæˆ‘ä¸çŸ¥é“æ»´æ»´æ‰“è½¦æ˜¯å¦ç”¨NSLogæ¥æ‰“å°æ—¥å¿—ï¼Œæ‰€ä»¥ï¼Œæœ¬æ–‡çš„æ–¹æ¡ˆå¹¶ä¸ç¬¦åˆç”Ÿäº§ç¯å¢ƒã€‚æ—¥å¿—æ˜¯éœ€è¦åˆ†ç±»çš„ï¼Œéœ€è¦å‹ç¼©ï¼Œéœ€è¦åŠ å¯†ï¼Œå®æ—¶æŸ“è‰²ç­‰ã€‚NSLogæ ¹æœ¬ä¸å¯èƒ½å®Œæˆè¿™äº›åŠŸèƒ½ï¼Œæ‰€ä»¥ï¼Œå¤§å‚çš„appéƒ½æœ‰ä¸“é—¨çš„æ—¥å¿—æ¡†æ¶ã€‚å„ä¸ªæ¨¡å—ä¸­ä¹Ÿä¸ä¼šç”¨NSLogæ¥è¾“å‡ºæ—¥å¿—ã€‚ [4èµ]
        </div>
        <br/>
<div>
    <div style="color:#888;font-size:15.25px;font-weight:400;line-height:1.2">ä½œè€…å›å¤2019-04-13 17:00:07</div>
    <div style="color:#353535;font-weight:400;white-space:normal;word-break:break-all;line-height:1.6">å¯¹ï¼Œå¤§å‚éƒ½æœ‰è‡ªå·±çš„æ—¥å¿—æ¡†æ¶ã€‚å¯èƒ½æ˜¯ä¸€å¥—æˆ–è€…å¤šå¥—ã€‚ä¹Ÿæœ‰å¾ˆå¤šç›´æ¥åŒ…è£…äº†CocoaLumberjackã€‚åŠ è§£å¯†ä¸€èˆ¬éƒ½æ˜¯å®‰å…¨å›¢é˜Ÿç»Ÿä¸€å¤„ç†çš„ï¼Œä¸å…‰ç”¨åœ¨æ—¥å¿—ä¸Šã€‚</div>
</div>
            
    </div>
</li>
            
<br/>

<li>
    <div>
        <div style="color: #888;font-size:15.25px;font-weight:400;line-height:1.2">
            Ant  2019-04-17 15:40:01
        </div>
        <div style="color:#353535;font-weight:400;white-space:normal;word-break:break-all;line-height:1.6">
            æ¸©æ•…è€ŒçŸ¥æ–°ï¼Œ å¯¹æˆ‘æ¥è¯´æ˜¯åè¿‡æ¥è¯´çš„ï¼Œ çŸ¥æ–°è€Œæ¸©æ•…ã€‚<br>mainå‡½æ•°æ‰§è¡Œä¹‹å‰  <br>åŠ è½½å¯æ‰§è¡Œæ–‡ä»¶ã€<br>åŠ è½½åŠ¨æ€é“¾æ¥åº“rebaseæŒ‡é’ˆè°ƒæ•´å’Œbindç¬¦å·ç»‘å®šã€<br>è¿è¡Œæ—¶å¼€å§‹å¤„ç†ï¼Œ<br>objcç±»æ³¨å†Œï¼Œcategoryæ³¨å†Œï¼Œselectorå”¯ä¸€æ€§æ£€æŸ¥ï¼Œ<br>loadæ–¹æ³•ï¼Œattributeä¿®é¥°å‡½æ•°è°ƒç”¨ï¼Œ<br>åˆ›å»ºc++é™æ€å…¨å±€å˜é‡ 
        </div>
        
    </div>
</li>
            
<br/>

<li>
    <div>
        <div style="color: #888;font-size:15.25px;font-weight:400;line-height:1.2">
            jimbo  2019-04-16 17:48:43
        </div>
        <div style="color:#353535;font-weight:400;white-space:normal;word-break:break-all;line-height:1.6">
            static void (&amp;orig_nslog)(NSString *format, ...); è¿™é‡Œæ˜¯ä¸æ˜¯åº”è¯¥å˜æˆ static void (*orig_nslog)(NSString *format, ...);  ä¸ç„¶æŠ¥é”™ 
        </div>
        
    </div>
</li>
            
<br/>

<li>
    <div>
        <div style="color: #888;font-size:15.25px;font-weight:400;line-height:1.2">
            Geek_f0e049  2019-04-14 11:14:38
        </div>
        <div style="color:#353535;font-weight:400;white-space:normal;word-break:break-all;line-height:1.6">
            ä¸Šå‘¨æ‰ç¬¬ä¸€æ¬¡ç”¨CocoaLumberjackåšäº†æ—¥å¿—ç³»ç»Ÿï¼Œå¹¶ä¸”çœ‹äº†fishhookçš„åŸç†ï¼Œè¿™æ¬¡çœ‹è¿™ç¯‡æ–‡ç« å°±å…¨ç”¨ä¸Šäº†ï¼Œå¤ªniceäº†ï¼Œå¯¹ä¸¤è€…çš„ä½¿ç”¨å’Œç†è§£æ›´æ·±äº†ã€‚å“ˆå“ˆğŸ˜„ 
        </div>
        <br/>
<div>
    <div style="color:#888;font-size:15.25px;font-weight:400;line-height:1.2">ä½œè€…å›å¤2019-04-14 11:52:05</div>
    <div style="color:#353535;font-weight:400;white-space:normal;word-break:break-all;line-height:1.6">èµ</div>
</div>
            
    </div>
</li>
            
<br/>

<li>
    <div>
        <div style="color: #888;font-size:15.25px;font-weight:400;line-height:1.2">
            drunkenMouse  2019-04-13 15:04:55
        </div>
        <div style="color:#353535;font-weight:400;white-space:normal;word-break:break-all;line-height:1.6">
            ASLåœ¨iOS10.0ä¹‹åæ²¡æ³•ç”¨äº†ã€‚æ‰€ä»¥CocoaLumberJackæ— æ³•è·å–åˆ°æ‰€æœ‰çš„æ—¥å¿—ï¼Œä½†é™¤äº†NSLogæ—¥å¿—å¤–ï¼Œåˆ«çš„æ—¥å¿—éƒ½èƒ½è·å–åˆ°å—ï¼Ÿ 
        </div>
        <br/>
<div>
    <div style="color:#888;font-size:15.25px;font-weight:400;line-height:1.2">ä½œè€…å›å¤2019-04-13 16:56:12</div>
    <div style="color:#353535;font-weight:400;white-space:normal;word-break:break-all;line-height:1.6">CocoaLumberJack å…¶ä»–æ—¥å¿—ä¸å—å½±å“</div>
</div>
            
    </div>
</li>
            
<br/>

<li>
    <div>
        <div style="color: #888;font-size:15.25px;font-weight:400;line-height:1.2">
            drunkenMouse  2019-04-13 15:03:16
        </div>
        <div style="color:#353535;font-weight:400;white-space:normal;word-break:break-all;line-height:1.6">
            æ‰€ä»¥ï¼Œå‡ ä¸ªäººçš„å°å›¢é˜Ÿç›´æ¥ä½¿ç”¨ç»Ÿä¸€çš„æ—¥å¿—åº“å°±å¯ä»¥äº†ï¼Ÿ<br><br>syslogdæ˜¯ä¸€ä¸ªè¿›ç¨‹ï¼Œä¿æŠ¤ç³»ç»Ÿæ¥æ”¶åˆ†å‘æ—¥å¿—æ¶ˆæ¯çš„è¿›ç¨‹ï¼Ÿ<br><br>CocoaLumberJackè¿™æ®µæœ‰ç‚¹ä¹±ï¼Œæ•´ç†äº†ä¸€ä¸‹ï¼š<br><br>captureAslLogsæ–¹æ³•å¯¹ASLæ—¥å¿—çš„å¤„ç†æªæ–½æ˜¯ï¼šå°†æ—¥å¿—æ¶ˆæ¯è½¬æ¢æˆchar * å­—ç¬¦ä¸²ç±»å‹ï¼Œç„¶åå†è½¬æˆNSStringç±»å‹ï¼Œéšåå°†å…¶è®°å½•ã€‚ <br>è®°å½•ä½¿ç”¨DDLogï¼šlogï¼šmessageï¼šæ–¹æ³•ã€‚<br>è®°å½•æ—¶éœ€è¦å°†NSStringè½¬æˆDDLogMessageç±»å‹ï¼Œè€ŒDDLogMessageè®¾ç½®äº†æ—¥å¿—çº§åˆ«ï¼Œæ‰€ä»¥è½¬æ¢ç±»å‹åä¹Ÿè¦è®¾ç½®æ—¥å¿—çº§åˆ«ã€‚<br><br>NSLogçš„æ—¥å¿—çº§åˆ«æ˜¯Verboseã€‚<br><br>æœ€åï¼ŒiOS10ä¹‹åï¼Œä¸ºäº†å…¼å®¹æ–°çš„ç»Ÿä¸€æ—¥å¿—ç³»ç»Ÿï¼Œéœ€è¦å¯¹NSLogæ—¥å¿—çš„è¾“å‡ºè¿›è¡Œé‡å®šå‘ã€‚iOS10ä¹‹åCocoaLumberJackè·å–ä¸åˆ°NSLogçš„æ—¥å¿—äº†ï¼Ÿ 
        </div>
        <br/>
<div>
    <div style="color:#888;font-size:15.25px;font-weight:400;line-height:1.2">ä½œè€…å›å¤2019-04-13 16:56:59</div>
    <div style="color:#353535;font-weight:400;white-space:normal;word-break:break-all;line-height:1.6">æ˜¯çš„</div>
</div>
            
    </div>
</li>
            </ul>
</div>
</body>
</html>